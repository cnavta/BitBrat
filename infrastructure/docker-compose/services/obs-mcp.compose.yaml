services:
  obs-mcp:
    image: us-central1-docker.pkg.dev/bitbrat-local/obs-mcp/obs-mcp:latest
    env_file:
      - .env.local
    environment:
      - GOOGLE_APPLICATION_CREDENTIALS=/var/secrets/google-app-creds.json
      - MCP_TRANSPORT
      - OBS_WEBSOCKET_URL
      - OBS_WEBSOCKET_SELF_SIGNED
      - OBS_WEBSOCKET_PASSWORD
      - MCP_AUTH_TOKEN
    volumes:
      - ${GOOGLE_APPLICATION_CREDENTIALS:?Set GOOGLE_APPLICATION_CREDENTIALS to a local JSON file}:/var/secrets/google-app-creds.json:ro
    ports:
      - "${OBS_MCP_HOST_PORT:-3001}:${SERVICE_PORT:-3000}"
    depends_on:
      - nats
      - firebase-emulator
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:3000/healthz"]
      interval: 5s
      timeout: 3s
      retries: 10
