# Prioritized Trackable YAML Backlog – sprint-132-a13b2f

meta:
  sprint: sprint-132-a13b2f
  owner: Junie
  createdAt: 2025-12-13T11:35:00Z
  notes: |
    The backlog enumerates planning tasks (P0) completed in this sprint and
    implementation tasks prioritized for subsequent sprints. Each item has a
    stable id, priority, estimate, dependencies, and acceptance criteria.

items:
  - id: P0-PLAN-001
    title: Create sprint implementation plan
    type: task
    priority: P0
    estimate: 1h
    status: done
    owner: Lead Implementor
    acceptance:
      - implementation-plan.md exists and covers Objective, Scope, Deliverables, Acceptance, Testing, Deployment, Dependencies, DoD

  - id: P0-PLAN-002
    title: Produce prioritized YAML backlog
    type: task
    priority: P0
    estimate: 1h
    status: done
    owner: Lead Implementor
    acceptance:
      - backlog.yaml exists with ids, priorities, estimates, dependencies, acceptance

  - id: P0-PLAN-003
    title: Add sprint validation script for planning deliverables
    type: task
    priority: P0
    estimate: 30m
    status: done
    owner: Lead Implementor
    acceptance:
      - validate_deliverable.sh exists and validates presence and YAML parse of manifest/backlog

  - id: P1-DATA-001
    title: Define Firestore data model for events and finalization
    type: story
    priority: P1
    estimate: 3
    status: done
    dependencies: []
    acceptance:
      - Documented schema for collections: events, with fields for correlationId, type, timestamps, payload, status, egress metadata
      - Migration/TTL approach documented (even if deferred)

  - id: P1-INGRESS-002
    title: Implement consumer for internal.ingress.v1 (persist event)
    type: story
    priority: P1
    estimate: 5
    status: done
    dependencies: [P1-DATA-001]
    acceptance:
      - Message handler persists normalized event document
      - Idempotent on correlationId (upsert)
      - Structured logs emitted with correlationId

  - id: P1-FINALIZE-003
    title: Implement consumer for internal.persistence.finalize.v1 (update final state)
    type: story
    priority: P1
    estimate: 5
    status: done
    dependencies: [P1-DATA-001]
    acceptance:
      - Handler updates final status and egress metadata
      - Safe if called before initial persist (creates stub then updates)
      - Idempotent and handles retries

  - id: P1-CORE-004
    title: Idempotency and key strategy
    type: task
    priority: P1
    estimate: 3
    status: done
    dependencies: [P1-DATA-001]
    acceptance:
      - Document and implement keying strategy (correlationId primary)
      - Upsert operations verified in tests

  - id: P1-TEST-005
    title: Unit tests for normalization and persistence helpers
    type: task
    priority: P1
    estimate: 3
    status: done
    dependencies: [P1-DATA-001, P1-INGRESS-002]
    acceptance:
      - Jest tests for normalization, key generation, upsert

  - id: P1-TEST-006
    title: Integration tests with mocked Firestore and messaging
    type: task
    priority: P1
    estimate: 5
    status: done
    dependencies: [P1-INGRESS-002, P1-FINALIZE-003]
    acceptance:
      - Tests simulate message flow and verify Firestore writes/updates via mocks

  - id: P2-OBS-007
    title: Observability and metrics hooks
    type: task
    priority: P2
    estimate: 3
    status: todo
    dependencies: []
    acceptance:
      - Add counters/timers around persistence/update paths
      - Structured logs include destination and correlationId

  - id: P2-DEPLOY-008
    title: Deployment and CI updates for persistence service
    type: task
    priority: P2
    estimate: 3
    status: todo
    dependencies: []
    acceptance:
      - Cloud Build pipeline validates build and tests for persistence
      - Cloud Run config aligns with architecture.yaml deploymentDefaults

  - id: P3-DOC-009
    title: Service documentation (README, runbooks)
    type: task
    priority: P3
    estimate: 2
    status: todo
    dependencies: [P1-INGRESS-002, P1-FINALIZE-003]
    acceptance:
      - README explains data model, topics, env vars, and validation steps

  - id: P4-RND-010
    title: Design spike – embeddings and search index
    type: spike
    priority: P4
    estimate: 3
    status: deferred
    dependencies: []
    acceptance:
      - Brief proposal for embedding pipeline and query-time retrieval

  - id: P1-BUG-011
    title: Fix Firestore undefined write error by stripping undefined values
    type: bug
    priority: P1
    estimate: 1
    status: done
    dependencies: [P1-INGRESS-002]
    acceptance:
      - Persistence service can persist events where optional fields are undefined
      - Undefined values are stripped from documents prior to Firestore writes
      - Tests cover undefined stripping and pass
