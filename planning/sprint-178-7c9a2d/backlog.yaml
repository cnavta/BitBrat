meta:
  backlog_id: sprint-178-7c9a2d
  updated_at: 2025-12-27
  status_values: [todo, in_progress, blocked, done]

sprint:
  id: sprint-178-7c9a2d
  start: 2025-12-27
  end: 2026-01-10
  wip_limit: 3
  goal: "Enable all services to offer SSE capabilities via McpServer while retaining BaseServer functionality."

items:
  - id: BL-178-001
    title: "McpServer Base Implementation"
    priority: P0
    status: done
    effort: S
    owner: agent
    deps: []
    acceptance:
      - "src/common/mcp-server.ts exists"
      - "McpServer extends BaseServer"
      - "McpServer initializes @modelcontextprotocol/sdk Server"
    updated_at: 2025-12-27
    log:
      - at: 2025-12-27T00:18:00Z
        note: "Starting implementation of McpServer base class."
      - at: 2025-12-27T00:20:00Z
        note: "McpServer base class and SSE routes implemented in src/common/mcp-server.ts."

  - id: BL-178-002
    title: "SSE Transport & Route Management"
    priority: P0
    status: done
    effort: M
    owner: agent
    deps: [BL-178-001]
    acceptance:
      - "/sse endpoint establishes SSE connection"
      - "/message endpoint handles POST messages"
      - "Session management tracks active transports"
    updated_at: 2025-12-27
    log:
      - at: 2025-12-27T00:20:00Z
        note: "SSE Transport management and /sse, /message routes implemented in src/common/mcp-server.ts."

  - id: BL-178-003
    title: "Type-safe Tool Registration"
    priority: P1
    status: done
    effort: S
    owner: agent
    deps: [BL-178-002]
    acceptance:
      - "registerTool supports Zod schemas"
      - "Registered tools are correctly exposed via MCP"
    updated_at: 2025-12-27
    log:
      - at: 2025-12-27T00:24:00Z
        note: "registerTool implemented using MCP SDK tool() method with Zod support."

  - id: BL-178-004
    title: "Resource & Prompt Registration"
    priority: P1
    status: done
    effort: S
    owner: agent
    deps: [BL-178-002]
    acceptance:
      - "registerResource supports URI-based resources"
      - "registerPrompt supports MCP prompts"
    updated_at: 2025-12-27
    log:
      - at: 2025-12-27T00:24:00Z
        note: "registerResource and registerPrompt implemented using MCP SDK helper methods."

  - id: BL-178-005
    title: "Security & Auth Implementation"
    priority: P1
    status: done
    effort: S
    owner: agent
    deps: [BL-178-002]
    acceptance:
      - "Endpoints validate MCP_AUTH_TOKEN if present"
    updated_at: 2025-12-27
    log:
      - at: 2025-12-27T00:22:00Z
        note: "Auth token validation implemented in /sse and /message routes."

  - id: BL-178-006
    title: "Observability Integration"
    priority: P2
    status: done
    effort: S
    owner: agent
    deps: [BL-178-002]
    acceptance:
      - "MCP calls are logged via BaseServer logger"
      - "MCP operations have OpenTelemetry spans"
    updated_at: 2025-12-27
    log:
      - at: 2025-12-27T00:26:00Z
        note: "Logging and OpenTelemetry tracing implemented for MCP operations."

  - id: BL-178-007
    title: "McpServer Unit Tests"
    priority: P0
    status: done
    effort: M
    owner: agent
    deps: [BL-178-003, BL-178-004]
    acceptance:
      - "Jest tests cover connection, message handling, and tool execution"
      - "Minimum 80% coverage for mcp-server.ts"
    updated_at: 2025-12-27
    log:
      - at: 2025-12-27T00:30:00Z
        note: "Comprehensive unit tests implemented in tests/common/mcp-server.spec.ts. All tests passing."

  - id: BL-178-009
    title: "McpServer Description from Architecture"
    priority: P1
    status: done
    effort: S
    owner: agent
    deps: [BL-178-001]
    acceptance:
      - "McpServer uses service description from architecture.yaml"
      - "McpServer uses project version from architecture.yaml"
    updated_at: 2025-12-27
    log:
      - at: 2025-12-27T00:58:00Z
        note: "Updated McpServer to use description and version from architecture.yaml."
