
> bitbrat-platform@1.0.0 test
> jest tests/common/mcp-server.spec.ts
  console.log
    {"ts":"2025-12-27T05:59:11.762Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.781Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.783Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.790Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.790Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.804Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.806Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.810Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.810Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.811Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.812Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.813Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.813Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.815Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.816Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.817Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.818Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.818Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.818Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.819Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.819Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.820Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.820Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.822Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.823Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.warn
    {"ts":"2025-12-27T05:59:11.824Z","service":"test-mcp-server","level":"warn","severity":"WARNING","msg":"mcp_server.auth_failed","path":"/sse","ip":"::ffff:127.0.0.1"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at authMiddleware (src/common/mcp-server.ts:162:28)
      at src/common/mcp-server.ts:174:7
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at app.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)
  console.log
    {"ts":"2025-12-27T05:59:11.826Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.827Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.827Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.828Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.828Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.828Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.830Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.830Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.warn
    {"ts":"2025-12-27T05:59:11.831Z","service":"test-mcp-server","level":"warn","severity":"WARNING","msg":"mcp_server.auth_failed","path":"/sse","ip":"::ffff:127.0.0.1"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at authMiddleware (src/common/mcp-server.ts:162:28)
      at src/common/mcp-server.ts:174:7
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at app.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)
  console.log
    {"ts":"2025-12-27T05:59:11.833Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.833Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.834Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.834Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.835Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.835Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.836Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.837Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.838Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.838Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.839Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.839Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.839Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.840Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.840Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.841Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.842Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.842Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.843Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.844Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.844Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.845Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.845Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.846Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.846Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.846Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.848Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.848Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.849Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.850Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.850Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.851Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.851Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.852Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.852Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.853Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.853Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.853Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.854Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.855Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.855Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.856Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"test_tool"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.857Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.857Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.858Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.858Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.859Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.859Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.860Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.861Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.861Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.resource_registered","name":"test_resource","uri":"file://test"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.862Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.862Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.862Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.863Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.863Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.864Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.865Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.865Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.866Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.prompt_registered","name":"test_prompt"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.866Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.866Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2025-12-27T05:59:11.867Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
(node:14818) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGTERM listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
(node:14818) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGINT listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:14818) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 beforeExit listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:14818) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 exit listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
 PASS  tests/common/mcp-server.spec.ts
  McpServer
    Endpoints Registration
      ✓ should register /sse and /message endpoints (51 ms)
    Security
      ✓ should allow access if MCP_AUTH_TOKEN is not set (7 ms)
      ✓ should return 401 if MCP_AUTH_TOKEN is set and token is missing (8 ms)
      ✓ should return 401 if MCP_AUTH_TOKEN is set and token is incorrect (7 ms)
      ✓ should allow access if correct token is provided in header (6 ms)
      ✓ should allow access if correct token is provided in query (5 ms)
    Registration Helpers
      ✓ should use description and version from architecture.yaml (8 ms)
      ✓ should register a tool correctly (5 ms)
      ✓ should register a resource correctly (5 ms)
      ✓ should register a prompt correctly (4 ms)
Test Suites: 1 passed, 1 total
Tests:       10 passed, 10 total
Snapshots:   0 total
Time:        2.2 s
Ran all test suites matching /tests\/common\/mcp-server.spec.ts/i.
