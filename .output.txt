
> bitbrat-platform@1.0.0 test
> jest
PASS src/apps/__tests__/ingress-egress-routing.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:22.510Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.529Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.530Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.530Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.531Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.532Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.534Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.535Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.535Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.536Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.536Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.536Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.537Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.537Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-c4jemds7","queue":"ingress-egress.proc-c4jemds7"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.537Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-c4jemds7","queue":"ingress-egress.proc-c4jemds7"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.537Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-c4jemds7","queue":"ingress-egress.proc-c4jemds7"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.537Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-c4jemds7"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.537Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.537Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.537Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.537Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.538Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.538Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:22.538Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.038Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-1","candidateId":"cand-1","priority":1,"createdAt":"2026-01-15T16:37:23.037Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.039Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-1","source":"ingress.discord","isDiscord":true,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.040Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-1","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.042Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.043Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.043Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.043Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.043Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.043Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.044Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.044Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.044Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.044Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.044Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.044Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.044Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-e562hq71","queue":"ingress-egress.proc-e562hq71"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.044Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-e562hq71","queue":"ingress-egress.proc-e562hq71"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.044Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-e562hq71","queue":"ingress-egress.proc-e562hq71"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.044Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-e562hq71"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.045Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.045Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.045Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.045Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.045Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.045Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.045Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.545Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-3","candidateId":"cand-3","priority":1,"createdAt":"2026-01-15T16:37:23.545Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.546Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-3","source":"command-processor","isDiscord":true,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.546Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-3","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.547Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.547Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.547Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.547Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.547Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.548Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.548Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.548Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.548Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.548Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.548Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.548Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.548Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-sl3z72g6","queue":"ingress-egress.proc-sl3z72g6"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.548Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-sl3z72g6","queue":"ingress-egress.proc-sl3z72g6"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.548Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-sl3z72g6","queue":"ingress-egress.proc-sl3z72g6"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.548Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-sl3z72g6"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.548Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.549Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.549Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.549Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.549Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.549Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:23.549Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.051Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-v1","source":"ingress.discord","isDiscord":true,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.051Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-v1","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.054Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.054Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.055Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.055Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.055Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.055Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.055Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.055Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-1z3oenp2","queue":"ingress-egress.proc-1z3oenp2"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-1z3oenp2","queue":"ingress-egress.proc-1z3oenp2"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-1z3oenp2","queue":"ingress-egress.proc-1z3oenp2"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-1z3oenp2"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.056Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.557Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-2","candidateId":"cand-2","priority":1,"createdAt":"2026-01-15T16:37:24.557Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.558Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-2","source":"ingress.twitch","isDiscord":false,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.558Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-2","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.561Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.561Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.561Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.562Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.562Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.563Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.563Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.563Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.563Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.563Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.563Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.563Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.563Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-k9ff8wc5","queue":"ingress-egress.proc-k9ff8wc5"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.563Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-k9ff8wc5","queue":"ingress-egress.proc-k9ff8wc5"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.563Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-k9ff8wc5","queue":"ingress-egress.proc-k9ff8wc5"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.563Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-k9ff8wc5"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.563Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.564Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.564Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.564Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.564Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.564Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:24.564Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:25.065Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-twilio","candidateId":"cand-twilio","priority":1,"createdAt":"2026-01-15T16:37:25.065Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:25.066Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-twilio","source":"ingress.twilio","isDiscord":false,"isTwilio":true}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:25.066Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-twilio","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.instance-memory.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:25.236Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:25.237Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:25.237Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:25.238Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.304Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.304Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.304Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/apps/scheduler-service.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:26.775Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.778Z","service":"scheduler","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.779Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.784Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.784Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.784Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/tick"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.784Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.784Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"list_schedules"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.785Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"get_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.785Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"create_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.785Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"update_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.785Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"delete_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.785Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.802Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.tick.http_received"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.803Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.tick.executing","count":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.803Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.executing_event","id":"sched-1","type":"test.event","correlationId":"37ec71e6-46e0-4e7c-afbd-3b3785a9a74e"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.822Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.822Z","service":"scheduler","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.822Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.824Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.824Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.824Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/tick"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.824Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.824Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"list_schedules"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.825Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"get_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.825Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"create_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.825Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"update_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.825Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"delete_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.825Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.827Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.tick.http_received"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.827Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.tick.executing","count":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.827Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.executing_event","id":"sched-once","type":"once.event","correlationId":"af4827ff-d4e8-4e36-b258-36fdd2729efe"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/persistence/store.spec.ts
PASS src/services/ingress/twitch/__tests__/eventsub-client.repro.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:26.915Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.starting","channels":["broadcaster"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.917Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.aliasing_bot_token","broadcasterId":"broadcaster-id","botId":"bot-id"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.917Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.918Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.starting","channels":["broadcaster"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.918Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.aliasing_bot_token","broadcasterId":"broadcaster-id","botId":"bot-id"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.918Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.919Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.starting","channels":["realbroadcaster"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.919Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.broadcaster_auth_found","userId":"real-broadcaster-id"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.919Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.920Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.starting","channels":["broadcaster"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.920Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.aliasing_bot_token","broadcasterId":"broadcaster-id","botId":"bot-id"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.920Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.920Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.event.stream_online","channel":"broadcaster","streamId":"12345"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.921Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.starting","channels":["broadcaster"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.921Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.aliasing_bot_token","broadcasterId":"broadcaster-id","botId":"bot-id"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.921Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T16:37:26.927Z","service":"bitbrat","level":"error","severity":"ERROR","msg":"twitch.eventsub.handler_error","kind":"stream.online","channel":"broadcaster","error":"Cannot read properties of null (reading 'id')","stack":"TypeError: Cannot read properties of null (reading 'id')\n    at /Users/christophernavta/IdeaProjects/BitBratPlatform/src/services/ingress/twitch/eventsub-client.ts:170:91\n    at Object.<anonymous> (/Users/christophernavta/IdeaProjects/BitBratPlatform/src/services/ingress/twitch/__tests__/eventsub-client.repro.spec.ts:210:11)"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at src/services/ingress/twitch/eventsub-client.ts:178:20
      at Object.<anonymous> (src/services/ingress/twitch/__tests__/eventsub-client.repro.spec.ts:210:11)
    console.log
      {"ts":"2026-01-15T16:37:26.927Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.starting","channels":["broadcaster"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.927Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.aliasing_bot_token","broadcasterId":"broadcaster-id","botId":"bot-id"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.928Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:26.928Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.stopped"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tools/brat/src/config/schema.routing.test.ts
PASS src/apps/__tests__/ingress-egress-webhooks.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:27.063Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.064Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.064Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.065Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.065Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.066Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.066Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.067Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.067Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.067Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.067Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.067Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"BotUser"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T16:37:27.177Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"Failed to initialize Twilio Conversations client","error":"Cannot read properties of undefined (reading 'AccessToken')"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at TwilioIngressClient.start (src/services/ingress/twilio/twilio-ingress-client.ts:230:14)
      at TwilioConnectorAdapter.start (src/services/ingress/twilio/connector-adapter.ts:12:23)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:35:30)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-15T16:37:27.177Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.177Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.177Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.177Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.177Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.177Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.177Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.177Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.576Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.received","EventType":"onConversationAdded","ConversationSid":"CH123"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.576Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot","ConversationSid":"CH123","botIdentity":"BotUser","trigger":"onConversationAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.577Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot.ok","ConversationSid":"CH123","trigger":"onConversationAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.581Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.582Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.582Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.582Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.582Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.582Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.583Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.583Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.583Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.583Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.583Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"BotUser"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T16:37:27.583Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"Failed to initialize Twilio Conversations client","error":"Cannot read properties of undefined (reading 'AccessToken')"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at TwilioIngressClient.start (src/services/ingress/twilio/twilio-ingress-client.ts:230:14)
      at TwilioConnectorAdapter.start (src/services/ingress/twilio/connector-adapter.ts:12:23)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:35:30)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-15T16:37:27.583Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.583Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.583Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.583Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.583Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.584Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.584Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:27.584Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.089Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.received","EventType":"onMessageAdded","ConversationSid":"CH456"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.089Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot","ConversationSid":"CH456","botIdentity":"BotUser","trigger":"onMessageAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.090Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot.ok","ConversationSid":"CH456","trigger":"onMessageAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.093Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.093Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.093Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.093Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.094Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.094Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.094Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.095Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.095Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.095Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.095Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"BotUser"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T16:37:28.095Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"Failed to initialize Twilio Conversations client","error":"Cannot read properties of undefined (reading 'AccessToken')"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at TwilioIngressClient.start (src/services/ingress/twilio/twilio-ingress-client.ts:230:14)
      at TwilioConnectorAdapter.start (src/services/ingress/twilio/connector-adapter.ts:12:23)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:35:30)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-15T16:37:28.095Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.095Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.095Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.095Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.096Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.096Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.096Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.096Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.601Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.received","EventType":"onMessageAdded","ConversationSid":"CH789"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.601Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot","ConversationSid":"CH789","botIdentity":"BotUser","trigger":"onMessageAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.601Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot.already_participant","ConversationSid":"CH789","trigger":"onMessageAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.605Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.605Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.605Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.605Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.605Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.606Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.606Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.606Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.606Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.606Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.606Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"BotUser"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T16:37:28.607Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"Failed to initialize Twilio Conversations client","error":"Cannot read properties of undefined (reading 'AccessToken')"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at TwilioIngressClient.start (src/services/ingress/twilio/twilio-ingress-client.ts:230:14)
      at TwilioConnectorAdapter.start (src/services/ingress/twilio/connector-adapter.ts:12:23)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:35:30)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-15T16:37:28.607Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.607Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.607Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.607Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.607Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.607Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.607Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:28.607Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T16:37:29.115Z","service":"ingress-egress","level":"warn","severity":"WARNING","msg":"twilio.webhook.invalid_signature","url":"http://127.0.0.1:54200/webhooks/twilio"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at src/apps/ingress-egress-service.ts:170:20
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:57:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:132:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)
    console.log
      {"ts":"2026-01-15T16:37:29.118Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:29.118Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tools/brat/src/providers/cdktf-synth.loadbalancer.routing.test.ts
  ● Console
    console.log
      {"component":"brat","action":"config.interpolate","vars_used":[],"unresolved":[],"notice":"Set BITBRAT_INTERPOLATION=0 to disable interpolation temporarily"}
      at loadArchitecture (tools/brat/src/config/loader.ts:151:15)
    console.log
      {"component":"brat","action":"config.interpolate","vars_used":[],"unresolved":[],"notice":"Set BITBRAT_INTERPOLATION=0 to disable interpolation temporarily"}
      at loadArchitecture (tools/brat/src/config/loader.ts:151:15)
    console.log
      {"component":"brat","action":"config.interpolate","vars_used":[],"unresolved":[],"notice":"Set BITBRAT_INTERPOLATION=0 to disable interpolation temporarily"}
      at loadArchitecture (tools/brat/src/config/loader.ts:151:15)
    console.log
      {"component":"brat","action":"config.interpolate","vars_used":[],"unresolved":[],"notice":"Set BITBRAT_INTERPOLATION=0 to disable interpolation temporarily"}
      at loadArchitecture (tools/brat/src/config/loader.ts:151:15)
    console.log
      {"component":"brat","action":"config.interpolate","vars_used":[],"unresolved":[],"notice":"Set BITBRAT_INTERPOLATION=0 to disable interpolation temporarily"}
      at loadArchitecture (tools/brat/src/config/loader.ts:151:15)
PASS src/services/llm-bot/processor.personality.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:29.251Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:29.252Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:29.252Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:29.252Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.empty-response.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:29.956Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:29.957Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:29.957Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:29.957Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:30.611Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:30.611Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:30.611Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:30.736Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:30.736Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:30.736Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:30.736Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:31.374Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.no_prompt","correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:31.375Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:31.376Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:31.376Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.personality-disabled.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:31.506Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:31.506Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:31.507Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:31.507Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/services/llm-bot/personality-with-memory.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:32.161Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/__tests__/command-processor-service.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:32.914Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:32.915Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:32.915Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:32.915Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:32.916Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:32.934Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:32.934Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T16:37:32.958Z","service":"command-processor","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at exec (src/apps/command-processor-service.ts:66:28)
      at src/apps/command-processor-service.ts:71:34
      at NoopContextManager.with (node_modules/@opentelemetry/api/src/context/NoopContextManager.ts:31:15)
      at ContextAPI.with (node_modules/@opentelemetry/api/src/api/context.ts:77:42)
      at NoopTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/NoopTracer.ts:98:27)
      at ProxyTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/ProxyTracer.ts:51:20)
      at src/apps/command-processor-service.ts:69:30
      at src/common/base-server.ts:302:39
      at src/common/tracing.ts:104:20
      at NoopContextManager.with (node_modules/@opentelemetry/api/src/context/NoopContextManager.ts:31:15)
      at ContextAPI.with (node_modules/@opentelemetry/api/src/api/context.ts:77:42)
      at NoopTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/NoopTracer.ts:98:27)
      at ProxyTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/ProxyTracer.ts:51:20)
      at startActiveSpan (src/common/tracing.ts:102:17)
      at subscriber.subscribe (src/common/base-server.ts:297:36)
      at capturedHandler (src/apps/__tests__/command-processor-service.test.ts:12:13)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:63:11)
    console.error
      {"ts":"2026-01-15T16:37:33.835Z","service":"command-processor","level":"error","severity":"ERROR","msg":"command_repo.findFirstByCommandTerm.error","term":"ping","error":"7 PERMISSION_DENIED: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at findFirstByCommandTerm (src/services/command-processor/command-repo.ts:143:12)
      at processEvent (src/services/command-processor/processor.ts:175:9)
      at exec (src/apps/command-processor-service.ts:66:22)
      at src/apps/command-processor-service.ts:71:28
      at src/apps/command-processor-service.ts:69:17
      at src/common/base-server.ts:302:17
      at src/common/tracing.ts:104:14
      at subscriber.subscribe (src/common/base-server.ts:297:15)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:63:5)
    console.error
      {"ts":"2026-01-15T16:37:33.836Z","service":"command-processor","level":"error","severity":"ERROR","msg":"command_processor.process_error","subject":"dev.internal.command.v1","error":"7 PERMISSION_DENIED: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at src/apps/command-processor-service.ts:100:20
      at src/common/base-server.ts:302:17
      at src/common/tracing.ts:104:14
      at subscriber.subscribe (src/common/base-server.ts:297:15)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:63:5)
    console.log
      {"ts":"2026-01-15T16:37:33.838Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:33.838Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:33.838Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:33.838Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:33.838Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:33.838Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:33.839Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T16:37:33.839Z","service":"command-processor","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at exec (src/apps/command-processor-service.ts:66:28)
      at src/apps/command-processor-service.ts:71:34
      at NoopContextManager.with (node_modules/@opentelemetry/api/src/context/NoopContextManager.ts:31:15)
      at ContextAPI.with (node_modules/@opentelemetry/api/src/api/context.ts:77:42)
      at NoopTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/NoopTracer.ts:98:27)
      at ProxyTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/ProxyTracer.ts:51:20)
      at src/apps/command-processor-service.ts:69:30
      at src/common/base-server.ts:302:39
      at src/common/tracing.ts:104:20
      at NoopContextManager.with (node_modules/@opentelemetry/api/src/context/NoopContextManager.ts:31:15)
      at ContextAPI.with (node_modules/@opentelemetry/api/src/api/context.ts:77:42)
      at NoopTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/NoopTracer.ts:98:27)
      at ProxyTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/ProxyTracer.ts:51:20)
      at startActiveSpan (src/common/tracing.ts:102:17)
      at subscriber.subscribe (src/common/base-server.ts:297:36)
      at capturedHandler (src/apps/__tests__/command-processor-service.test.ts:12:13)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:88:11)
    console.error
      {"ts":"2026-01-15T16:37:33.888Z","service":"command-processor","level":"error","severity":"ERROR","msg":"command_repo.findFirstByCommandTerm.error","term":"ping","error":"7 PERMISSION_DENIED: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at findFirstByCommandTerm (src/services/command-processor/command-repo.ts:143:12)
      at processEvent (src/services/command-processor/processor.ts:175:9)
      at exec (src/apps/command-processor-service.ts:66:22)
      at src/apps/command-processor-service.ts:71:28
      at src/apps/command-processor-service.ts:69:17
      at src/common/base-server.ts:302:17
      at src/common/tracing.ts:104:14
      at subscriber.subscribe (src/common/base-server.ts:297:15)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:88:5)
    console.error
      {"ts":"2026-01-15T16:37:33.888Z","service":"command-processor","level":"error","severity":"ERROR","msg":"command_processor.process_error","subject":"dev.internal.command.v1","error":"7 PERMISSION_DENIED: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at src/apps/command-processor-service.ts:100:20
      at src/common/base-server.ts:302:17
      at src/common/tracing.ts:104:14
      at subscriber.subscribe (src/common/base-server.ts:297:15)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:88:5)
  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "{"ts":"2026-01-15T16:37:34.016Z","service":"command-processor","level":"error","severity":"ERROR","msg":"regex_cache.snapshot.error","error":"Error 7: Missing or insufficient permissions."}".
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at console.error (node_modules/@jest/console/build/BufferedConsole.js:127:10)
      at Logger.error (src/common/logging.ts:132:13)
      at QueryWatch.onError (src/services/command-processor/regex-cache.ts:150:14)
      at QueryWatch.closeStream (node_modules/@google-cloud/firestore/build/src/watch.js:227:18)
      at QueryWatch.onData (node_modules/@google-cloud/firestore/build/src/watch.js:376:22)
      at PassThrough.<anonymous> (node_modules/@google-cloud/firestore/build/src/watch.js:322:26)
      at StreamProxy.ondata (node_modules/readable-stream/lib/_stream_readable.js:629:20)
      at addChunk (node_modules/readable-stream/lib/_stream_readable.js:279:12)
      at readableAddChunk (node_modules/readable-stream/lib/_stream_readable.js:262:11)
      at StreamProxy.Object.<anonymous>.Readable.push (node_modules/readable-stream/lib/_stream_readable.js:228:10)
      at StreamProxy.Object.<anonymous>.Duplexify._forward (node_modules/duplexify/index.js:172:26)
      at ClientDuplexStreamImpl.onreadable (node_modules/duplexify/index.js:136:10)
PASS src/services/llm-bot/processor.memory.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:33.968Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:33.969Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:33.969Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:33.970Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:34.580Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:34.580Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:34.580Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:34.631Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:34.631Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:34.631Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/services/llm-bot/mcp/web-search.test.ts
  ● Console
    console.log
      mcp_search_web schema: {
        "jsonSchema": {
          "type": "object",
          "properties": {
            "query": {
              "type": "string"
            },
            "limit": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10
            }
          },
          "required": [
            "query"
          ],
          "additionalProperties": false,
          "$schema": "http://json-schema.org/draft-07/schema#"
        }
      }
      at Object.<anonymous> (tests/services/llm-bot/mcp/web-search.test.ts:37:13)
PASS src/services/llm-bot/processor.error.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:35.215Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.216Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.216Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.216Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T16:37:35.801Z","service":"test-llm-bot","level":"error","severity":"ERROR","msg":"llm_bot.processor.error","correlationId":"c-error","error":"boom","stack":"Error: boom\n    at Object.callLLM (/Users/christophernavta/IdeaProjects/BitBratPlatform/src/services/llm-bot/processor.error.spec.ts:27:15)\n    at processEvent (/Users/christophernavta/IdeaProjects/BitBratPlatform/src/services/llm-bot/processor.ts:276:34)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/christophernavta/IdeaProjects/BitBratPlatform/src/services/llm-bot/processor.error.spec.ts:25:20)"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at processEvent (src/services/llm-bot/processor.ts:391:12)
      at Object.<anonymous> (src/services/llm-bot/processor.error.spec.ts:25:20)
(node:88061) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGTERM listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
(node:88061) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGINT listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:88061) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 beforeExit listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:88061) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 exit listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
PASS tests/common/mcp-server.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:35.893Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.894Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.894Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.897Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.897Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.899Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.900Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.904Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.904Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.904Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.904Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.905Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.905Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.906Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.906Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.907Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.908Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.909Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.909Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.910Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.910Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.910Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.910Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.911Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.912Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T16:37:35.919Z","service":"test-mcp-server","level":"warn","severity":"WARNING","msg":"mcp_server.auth_failed","path":"/sse","ip":"::ffff:127.0.0.1"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at authMiddleware (src/common/mcp-server.ts:187:28)
      at src/common/mcp-server.ts:199:7
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at app.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)
    console.log
      {"ts":"2026-01-15T16:37:35.921Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.921Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.921Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.922Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.922Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.922Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.923Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.923Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T16:37:35.924Z","service":"test-mcp-server","level":"warn","severity":"WARNING","msg":"mcp_server.auth_failed","path":"/sse","ip":"::ffff:127.0.0.1"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at authMiddleware (src/common/mcp-server.ts:187:28)
      at src/common/mcp-server.ts:199:7
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at app.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)
    console.log
      {"ts":"2026-01-15T16:37:35.926Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.926Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.926Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.926Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.927Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.927Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.927Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.928Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.929Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.930Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.931Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.931Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.931Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.932Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.932Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.932Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.933Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.933Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.935Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.936Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.937Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.937Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.937Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.937Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.938Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.938Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.938Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.938Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.939Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.939Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.939Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.939Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.939Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.940Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.940Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.940Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.940Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.940Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.941Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.941Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.941Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.942Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"test_tool"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.942Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.942Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.942Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.943Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.943Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.943Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.943Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.944Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.944Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.resource_registered","name":"test_resource","uri":"file://test"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.944Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.944Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.944Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.945Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.945Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.945Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.946Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.947Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.947Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.prompt_registered","name":"test_prompt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.947Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.947Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:35.948Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/ingress-egress-service.finalize.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:36.078Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.079Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.079Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.079Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.079Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.079Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.079Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T16:37:36.102Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"connector.start_error","name":"twitch","error":"twitch_auth_missing"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:39:34)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-15T16:37:36.102Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.102Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.102Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-a54om3mn","queue":"ingress-egress.proc-a54om3mn"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.102Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-a54om3mn"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.102Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.102Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.102Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.102Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.103Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.103Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.103Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"fx-1","candidateId":"c1","priority":1,"createdAt":"2026-01-15T16:37:36.103Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.104Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"fx-1","source":"","isDiscord":false,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.104Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"fx-1","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/ingress-egress-service.krevision.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:36.209Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.210Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.210Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.210Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.225Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/services/command-processor/routing-advance.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:36.301Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.302Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.302Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.302Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.303Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.319Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.320Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.341Z","service":"command-processor","level":"info","severity":"INFO","msg":"routing.next.published","subject":"dev.internal.egress.v1","stepIndex":1,"attempt":0,"correlationId":"c-adv-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.342Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.342Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.342Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.342Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.342Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.343Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.343Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.345Z","service":"command-processor","level":"info","severity":"INFO","msg":"routing.next.fallback_egress","dest":"dev.internal.egress.v1.dev1","correlationId":"c-adv-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.346Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.346Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.346Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.346Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.346Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.346Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.347Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/ingress-egress-service.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:36.456Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.457Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.457Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.458Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.458Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:36.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/common/__tests__/base-server-yaml.test.ts
PASS tests/services/llm-bot/mcp/client-manager.spec.ts
ReferenceError: You are trying to `import` a file after the Jest environment has been torn down. From tests/services/command-processor/routing-advance.spec.ts.
      at Firestore.get (node_modules/@google-cloud/firestore/build/src/index.js:1540:16)
      at ClientPool.clientFactory (node_modules/@google-cloud/firestore/build/src/index.js:526:45)
      at ClientPool.acquire (node_modules/@google-cloud/firestore/build/src/pool.js:121:35)
      at ClientPool.run (node_modules/@google-cloud/firestore/build/src/pool.js:260:29)
      at node_modules/@google-cloud/firestore/build/src/index.js:1412:30
      at Firestore._retry (node_modules/@google-cloud/firestore/build/src/index.js:1270:30)
PASS src/services/oauth/routes.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:37.136Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.start","provider":"mockprov","identity":"bot","mode":"json"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:37.142Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.start","provider":"mockprov","identity":"bot","mode":"redirect"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T16:37:37.146Z","service":"bitbrat","level":"error","severity":"ERROR","msg":"oauth.routes.start.error","error":"unknown_provider:unknown"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at src/services/oauth/routes.ts:43:14
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at app.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)
    console.log
      {"ts":"2026-01-15T16:37:37.152Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.callback.success","provider":"mockprov","identity":"bot","stored":false,"tokenType":"***"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:37.164Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.status","provider":"mockprov","identity":"bot","status":"absent"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:37.167Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.callback.success","provider":"mockprov","identity":"bot","stored":true,"tokenType":"***"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:37.170Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.status","provider":"mockprov","identity":"bot","status":"present"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/message-bus/__tests__/pubsub-subscriber-logging.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:37.442Z","service":"bitbrat","level":"info","severity":"INFO","msg":"pubsub.client.init","apiEndpoint":"default","projectId":"auto"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:37.444Z","service":"bitbrat","level":"info","severity":"INFO","msg":"message_consumer.subscribe.start","driver":"pubsub","topic":"topic.test","subscription":"topic.test.sub","ackDeadline":60}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:37.444Z","service":"bitbrat","level":"info","severity":"INFO","msg":"message_consumer.subscribe.ready","driver":"pubsub","subscription":"topic.test.sub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:37.460Z","service":"bitbrat","level":"info","severity":"INFO","msg":"pubsub.client.init","apiEndpoint":"default","projectId":"auto"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:37.460Z","service":"bitbrat","level":"info","severity":"INFO","msg":"message_consumer.subscribe.start","driver":"pubsub","topic":"topic.test","subscription":"topic.test.sub","ackDeadline":60}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:37.460Z","service":"bitbrat","level":"info","severity":"INFO","msg":"message_consumer.subscribe.ready","driver":"pubsub","subscription":"topic.test.sub"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/base-server-onmessage.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:37.679Z","service":"test","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:37.679Z","service":"test","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:37.680Z","service":"test","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:37.680Z","service":"test","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.test.json","queue":"test"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:37.680Z","service":"test","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.test.json","queue":"test"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/auth/__tests__/user-repo.spec.ts
PASS tools/brat/src/orchestration/exec.spec.ts
PASS src/services/persistence/integration.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:38.297Z","service":"persistence","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.300Z","service":"persistence","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.300Z","service":"persistence","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.300Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.subscribe.ok","destination":"internal.ingress.v1","queue":"persistence"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.300Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.subscribe.ok","destination":"internal.persistence.finalize.v1","queue":"persistence"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.300Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.subscribe.ok","destination":"internal.deadletter.v1","queue":"persistence"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.301Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.subscribe.ok","destination":"internal.router.dlq.v1","queue":"persistence"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.301Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.message.received","destination":"internal.ingress.v1","type":"chat.message.v1","correlationId":"it-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.301Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.upsert.ok","correlationId":"it-1","status":"INGESTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.303Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.message.received","destination":"internal.persistence.finalize.v1","correlationId":"it-2"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.304Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.finalize.ok","correlationId":"it-2","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.305Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.message.received","destination":"internal.persistence.finalize.v1","correlationId":"it-3"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.305Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.finalize.ok","correlationId":"it-3","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.306Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.message.received","destination":"internal.persistence.finalize.v1","correlationId":"it-ttl-seconds"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.306Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.finalize.ok","correlationId":"it-ttl-seconds","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/common/firebase.test.ts
PASS src/common/base-server.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:38.840Z","service":"test-svc","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.840Z","service":"test-svc","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.840Z","service":"test-svc","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.855Z","service":"custom","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.855Z","service":"custom","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.856Z","service":"custom","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/oauth-service.oauth-routes.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:38.935Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.937Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.937Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:38.937Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/__tests__/processor.unwrap-quotes.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:39.023Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:39.024Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:39.024Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/ingress/twilio/__tests__/token-provider.spec.ts
  ● Console
    console.error
      {"ts":"2026-01-15T16:37:39.213Z","service":"bitbrat","level":"error","severity":"ERROR","msg":"twilio.token_provider.config_missing","missing":["twilioAccountSid","twilioApiKey","twilioApiSecret","twilioChatServiceSid"]}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at TwilioTokenProvider.generateToken (src/services/ingress/twilio/token-provider.ts:22:14)
      at src/services/ingress/twilio/__tests__/token-provider.spec.ts:22:27
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/services/ingress/twilio/__tests__/token-provider.spec.ts:22:50)
PASS src/common/retry.test.ts
PASS tests/llm-bot-service.spec.ts
PASS tests/services/command-processor/processor.spec.ts
  ● Console
    console.warn
      {"ts":"2026-01-15T16:37:39.671Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/processor.spec.ts:30:35)
    console.log
      {"ts":"2026-01-15T16:37:39.672Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"ping","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:39.672Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"ping","id":"cmd1","kind":"command"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:39.672Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.template.chosen","name":"ping","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:39.672Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.candidate.added","name":"ping","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T16:37:39.673Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/processor.spec.ts:56:35)
    console.log
      {"ts":"2026-01-15T16:37:39.673Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"note","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:39.673Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"note","id":"cmdA","kind":"command"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:39.673Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.effect.added","effect":"annotation","name":"note","kind":"prompt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T16:37:39.674Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/processor.spec.ts:79:35)
    console.log
      {"ts":"2026-01-15T16:37:39.674Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"cool","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:39.674Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"cool","id":"cmd3","kind":"command"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T16:37:39.675Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/processor.spec.ts:99:35)
    console.log
      {"ts":"2026-01-15T16:37:39.675Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"missing","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T16:37:39.675Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/processor.spec.ts:118:35)
    console.log
      {"ts":"2026-01-15T16:37:39.675Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"rate","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:39.675Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"rate","id":"cmd2","kind":"command"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T16:37:39.676Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/processor.spec.ts:147:35)
PASS src/services/routing/__tests__/router-engine-annotations.spec.ts
PASS src/services/ingress/twitch/publisher.spec.ts
  ● Console
    console.warn
      {"ts":"2026-01-15T16:37:40.044Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"ingress.publish.retry","subject":"internal.ingress.v1","attempt":1,"code":14}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at Object.shouldRetry (src/services/ingress/twitch/publisher.ts:78:18)
      at withBackoff (src/common/retry.ts:41:37)
      at TwitchIngressPublisher.publish (src/services/ingress/twitch/publisher.ts:48:17)
      at Object.<anonymous> (src/services/ingress/twitch/publisher.spec.ts:79:17)
    console.warn
      {"ts":"2026-01-15T16:37:40.046Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"ingress.publish.retry","subject":"internal.ingress.v1","attempt":2,"code":14}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at Object.shouldRetry (src/services/ingress/twitch/publisher.ts:78:18)
      at withBackoff (src/common/retry.ts:41:37)
      at TwitchIngressPublisher.publish (src/services/ingress/twitch/publisher.ts:48:17)
      at Object.<anonymous> (src/services/ingress/twitch/publisher.spec.ts:79:17)
    console.warn
      {"ts":"2026-01-15T16:37:40.049Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"ingress.publish.no_retry_on_timeout","subject":"dev.internal.ingress.v1","attempt":1,"code":4,"reason":"publish_timeout"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at Object.shouldRetry (src/services/ingress/twitch/publisher.ts:67:18)
      at withBackoff (src/common/retry.ts:41:37)
      at TwitchIngressPublisher.publish (src/services/ingress/twitch/publisher.ts:48:17)
      at Object.<anonymous> (src/services/ingress/twitch/publisher.spec.ts:102:5)
PASS src/services/oauth/oauth-flow.integration.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:40.283Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.start","provider":"twitch","identity":"bot","mode":"redirect"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.287Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.start","provider":"twitch","identity":"bot","mode":"json"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.292Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.callback.success","provider":"twitch","identity":"bot","stored":true,"tokenType":"***","providerUserId":"u-123"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.295Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.status","provider":"twitch","identity":"bot","status":"present"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/common/base-server.debug-config.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:40.515Z","service":"test-svc","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.515Z","service":"test-svc","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.516Z","service":"test-svc","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/types/events.types.test.ts
PASS src/apps/scheduler-service.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:40.821Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.822Z","service":"scheduler","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.822Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.825Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.825Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.825Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/tick"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.826Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.826Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"list_schedules"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.826Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"get_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.826Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"create_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.826Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"update_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.826Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"delete_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:40.826Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/auth/__tests__/enrichment.spec.ts
PASS tests/services/command-processor/command-repo.spec.ts
PASS tests/prompt-assembly/adapters/google.spec.ts
PASS src/apps/auth-service.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:41.291Z","service":"auth","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.292Z","service":"auth","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.292Z","service":"auth","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.292Z","service":"auth","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/counters"}
      at Logger.info (src/common/logging.ts:142:13)
PASS infrastructure/scripts/extract-config.test.ts
PASS src/services/ingress/discord/discord-integration.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:41.603Z","service":"bitbrat","level":"info","severity":"INFO","msg":"ingress-egress.discord.start","guildId":"g1","channelsCount":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.605Z","service":"bitbrat","level":"info","severity":"INFO","msg":"ingress-egress.discord.message.published","correlationId":"47e9394c-db84-4009-8163-a13840209770","channelId":"c1"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/base-server-routing.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:41.828Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.829Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.829Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.830Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.next.published","subject":"internal.bot.requests.v1","stepIndex":1,"attempt":0,"correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.830Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.831Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.831Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.831Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.next.published","subject":"internal.step2.v1","stepIndex":1,"attempt":0,"correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.831Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.832Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.832Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.832Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.next.fallback_egress","dest":"internal.egress.v1","correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.838Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.839Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.839Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.839Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.complete.published","dest":"internal.egress.v1","correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.840Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.840Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.840Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.840Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.complete.published","dest":"internal.egress.v1","correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.841Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.841Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.841Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.841Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.next.published","subject":"internal.bot.requests.v1","stepIndex":0,"attempt":0,"correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.842Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.842Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.842Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.853Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.next.published","subject":"internal.bot.requests.v1","stepIndex":0,"attempt":1,"correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/llm-bot-service.test.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:41.964Z","service":"llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.966Z","service":"llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.966Z","service":"llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.966Z","service":"llm-bot","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.llmbot.v1","queue":"llm-bot"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:41.967Z","service":"llm-bot","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.llmbot.v1","queue":"llm-bot"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/base-server-step-update.spec.ts
  ● Console
    console.log
      {"ts":"2026-01-15T16:37:42.038Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.039Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.039Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.040Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.040Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.040Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.049Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.050Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.050Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.050Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.051Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.051Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.051Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.051Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T16:37:42.051Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
LINE LIMIT EXCEEDED