
up to date, audited 903 packages in 2s
167 packages are looking for funding
  run `npm fund` for details
6 vulnerabilities (2 moderate, 4 high)
To address all issues, run:
  npm audit fix
Run `npm audit` for details.
üß± Compiling...
> bitbrat-platform@1.0.0 build
> tsc -p tsconfig.json
üß™ Running tests (scope=all)...
üîí Discord validation state: DISCORD_ENABLED=false
> bitbrat-platform@1.0.0 test
> jest
PASS src/apps/__tests__/ingress-egress-routing.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:36.390Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.407Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.408Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.408Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.408Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.410Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.411Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.412Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.413Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.413Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-9rm1aki8","queue":"ingress-egress.proc-9rm1aki8"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-9rm1aki8","queue":"ingress-egress.proc-9rm1aki8"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-9rm1aki8","queue":"ingress-egress.proc-9rm1aki8"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-9rm1aki8"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.415Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.415Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.415Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.917Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-1","candidateId":"cand-1","priority":1,"createdAt":"2026-01-08T23:33:36.915Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.924Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-1","source":"ingress.discord","isDiscord":true,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.925Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-1","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.931Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.931Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.931Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.931Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.932Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.932Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.933Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.933Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.933Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.933Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.933Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.933Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.933Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-4ktg2mkb","queue":"ingress-egress.proc-4ktg2mkb"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.933Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-4ktg2mkb","queue":"ingress-egress.proc-4ktg2mkb"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.934Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-4ktg2mkb","queue":"ingress-egress.proc-4ktg2mkb"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.934Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-4ktg2mkb"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.934Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.934Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.934Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.934Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.934Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.934Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:36.934Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.434Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-3","candidateId":"cand-3","priority":1,"createdAt":"2026-01-08T23:33:37.434Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.435Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-3","source":"command-processor","isDiscord":true,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.435Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-3","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.438Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.438Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.439Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.439Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.439Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.440Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.440Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.440Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.441Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.441Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.441Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.441Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.442Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-jr4ff8g7","queue":"ingress-egress.proc-jr4ff8g7"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.442Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-jr4ff8g7","queue":"ingress-egress.proc-jr4ff8g7"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.442Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-jr4ff8g7","queue":"ingress-egress.proc-jr4ff8g7"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.442Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-jr4ff8g7"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.442Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.442Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.443Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.443Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.443Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.443Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.443Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.944Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-v1","source":"ingress.discord","isDiscord":true,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.944Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-v1","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.946Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.947Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.947Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.947Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.948Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.948Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.949Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.949Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.949Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.949Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.949Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.950Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.950Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-spis2545","queue":"ingress-egress.proc-spis2545"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.950Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-spis2545","queue":"ingress-egress.proc-spis2545"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.950Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-spis2545","queue":"ingress-egress.proc-spis2545"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.950Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-spis2545"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.950Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.950Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.950Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.951Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.951Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.951Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:37.951Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.452Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-2","candidateId":"cand-2","priority":1,"createdAt":"2026-01-08T23:33:38.452Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.453Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-2","source":"ingress.twitch","isDiscord":false,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.453Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-2","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.455Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.456Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.456Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.456Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.457Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.457Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.457Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.458Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.458Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.458Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.458Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.458Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.458Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-nynkw43p","queue":"ingress-egress.proc-nynkw43p"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-nynkw43p","queue":"ingress-egress.proc-nynkw43p"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-nynkw43p","queue":"ingress-egress.proc-nynkw43p"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-nynkw43p"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.459Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.959Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-twilio","candidateId":"cand-twilio","priority":1,"createdAt":"2026-01-08T23:33:38.959Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.959Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-twilio","source":"ingress.twilio","isDiscord":false,"isTwilio":true}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:38.960Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-twilio","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/__tests__/command-processor-service.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:39.078Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:39.083Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:39.083Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:39.084Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:39.086Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:39.259Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:39.260Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-08T23:33:39.293Z","service":"command-processor","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at exec (src/apps/command-processor-service.ts:66:28)
      at src/apps/command-processor-service.ts:71:34
      at NoopContextManager.with (node_modules/@opentelemetry/api/src/context/NoopContextManager.ts:31:15)
      at ContextAPI.with (node_modules/@opentelemetry/api/src/api/context.ts:77:42)
      at NoopTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/NoopTracer.ts:98:27)
      at ProxyTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/ProxyTracer.ts:51:20)
      at src/apps/command-processor-service.ts:69:30
      at src/common/base-server.ts:302:39
      at src/common/tracing.ts:104:20
      at NoopContextManager.with (node_modules/@opentelemetry/api/src/context/NoopContextManager.ts:31:15)
      at ContextAPI.with (node_modules/@opentelemetry/api/src/api/context.ts:77:42)
      at NoopTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/NoopTracer.ts:98:27)
      at ProxyTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/ProxyTracer.ts:51:20)
      at startActiveSpan (src/common/tracing.ts:102:17)
      at subscriber.subscribe (src/common/base-server.ts:297:36)
      at capturedHandler (src/apps/__tests__/command-processor-service.test.ts:12:13)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:63:11)
    console.error
      {"ts":"2026-01-08T23:33:40.888Z","service":"command-processor","level":"error","severity":"ERROR","msg":"regex_cache.snapshot.error","error":"Error 7: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at QueryWatch.onError (src/services/command-processor/regex-cache.ts:150:14)
      at QueryWatch.closeStream (node_modules/@google-cloud/firestore/build/src/watch.js:227:18)
      at QueryWatch.onData (node_modules/@google-cloud/firestore/build/src/watch.js:376:22)
      at PassThrough.<anonymous> (node_modules/@google-cloud/firestore/build/src/watch.js:322:26)
      at StreamProxy.ondata (node_modules/readable-stream/lib/_stream_readable.js:629:20)
      at addChunk (node_modules/readable-stream/lib/_stream_readable.js:279:12)
      at readableAddChunk (node_modules/readable-stream/lib/_stream_readable.js:262:11)
      at StreamProxy.Object.<anonymous>.Readable.push (node_modules/readable-stream/lib/_stream_readable.js:228:10)
      at StreamProxy.Object.<anonymous>.Duplexify._forward (node_modules/duplexify/index.js:172:26)
      at ClientDuplexStreamImpl.onreadable (node_modules/duplexify/index.js:136:10)
    console.error
      {"ts":"2026-01-08T23:33:40.951Z","service":"command-processor","level":"error","severity":"ERROR","msg":"command_repo.findFirstByCommandTerm.error","term":"ping","error":"7 PERMISSION_DENIED: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at findFirstByCommandTerm (src/services/command-processor/command-repo.ts:143:12)
      at processEvent (src/services/command-processor/processor.ts:175:9)
      at exec (src/apps/command-processor-service.ts:66:22)
      at src/apps/command-processor-service.ts:71:28
      at src/apps/command-processor-service.ts:69:17
      at src/common/base-server.ts:302:17
      at src/common/tracing.ts:104:14
      at subscriber.subscribe (src/common/base-server.ts:297:15)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:63:5)
    console.error
      {"ts":"2026-01-08T23:33:40.951Z","service":"command-processor","level":"error","severity":"ERROR","msg":"command_processor.process_error","subject":"dev.internal.command.v1","error":"7 PERMISSION_DENIED: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at src/apps/command-processor-service.ts:100:20
      at src/common/base-server.ts:302:17
      at src/common/tracing.ts:104:14
      at subscriber.subscribe (src/common/base-server.ts:297:15)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:63:5)
    console.log
      {"ts":"2026-01-08T23:33:40.952Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:40.953Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:40.953Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:40.953Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:40.953Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:40.953Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:40.954Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-08T23:33:40.954Z","service":"command-processor","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at exec (src/apps/command-processor-service.ts:66:28)
      at src/apps/command-processor-service.ts:71:34
      at NoopContextManager.with (node_modules/@opentelemetry/api/src/context/NoopContextManager.ts:31:15)
      at ContextAPI.with (node_modules/@opentelemetry/api/src/api/context.ts:77:42)
      at NoopTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/NoopTracer.ts:98:27)
      at ProxyTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/ProxyTracer.ts:51:20)
      at src/apps/command-processor-service.ts:69:30
      at src/common/base-server.ts:302:39
      at src/common/tracing.ts:104:20
      at NoopContextManager.with (node_modules/@opentelemetry/api/src/context/NoopContextManager.ts:31:15)
      at ContextAPI.with (node_modules/@opentelemetry/api/src/api/context.ts:77:42)
      at NoopTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/NoopTracer.ts:98:27)
      at ProxyTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/ProxyTracer.ts:51:20)
      at startActiveSpan (src/common/tracing.ts:102:17)
      at subscriber.subscribe (src/common/base-server.ts:297:36)
      at capturedHandler (src/apps/__tests__/command-processor-service.test.ts:12:13)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:88:11)
    console.error
      {"ts":"2026-01-08T23:33:41.657Z","service":"command-processor","level":"error","severity":"ERROR","msg":"command_repo.findFirstByCommandTerm.error","term":"ping","error":"7 PERMISSION_DENIED: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at findFirstByCommandTerm (src/services/command-processor/command-repo.ts:143:12)
      at processEvent (src/services/command-processor/processor.ts:175:9)
      at exec (src/apps/command-processor-service.ts:66:22)
      at src/apps/command-processor-service.ts:71:28
      at src/apps/command-processor-service.ts:69:17
      at src/common/base-server.ts:302:17
      at src/common/tracing.ts:104:14
      at subscriber.subscribe (src/common/base-server.ts:297:15)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:88:5)
    console.error
      {"ts":"2026-01-08T23:33:41.657Z","service":"command-processor","level":"error","severity":"ERROR","msg":"command_processor.process_error","subject":"dev.internal.command.v1","error":"7 PERMISSION_DENIED: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at src/apps/command-processor-service.ts:100:20
      at src/common/base-server.ts:302:17
      at src/common/tracing.ts:104:14
      at subscriber.subscribe (src/common/base-server.ts:297:15)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:88:5)
PASS src/apps/__tests__/ingress-egress-webhooks.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:41.801Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.803Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.803Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.803Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.804Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.805Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.805Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.805Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.806Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.807Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.807Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.807Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"BotUser"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-08T23:33:41.989Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"Failed to initialize Twilio Conversations client","error":"Cannot read properties of undefined (reading 'AccessToken')"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at TwilioIngressClient.start (src/services/ingress/twilio/twilio-ingress-client.ts:230:14)
      at TwilioConnectorAdapter.start (src/services/ingress/twilio/connector-adapter.ts:12:23)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:35:30)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-08T23:33:41.989Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.989Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.990Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.990Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.990Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.990Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.990Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:41.990Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.337Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.received","EventType":"onConversationAdded","ConversationSid":"CH123"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.337Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot","ConversationSid":"CH123","botIdentity":"BotUser","trigger":"onConversationAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.338Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot.ok","ConversationSid":"CH123","trigger":"onConversationAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.343Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.343Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.343Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.343Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.343Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.344Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.344Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.344Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.344Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.344Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.344Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"BotUser"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-08T23:33:42.344Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"Failed to initialize Twilio Conversations client","error":"Cannot read properties of undefined (reading 'AccessToken')"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at TwilioIngressClient.start (src/services/ingress/twilio/twilio-ingress-client.ts:230:14)
      at TwilioConnectorAdapter.start (src/services/ingress/twilio/connector-adapter.ts:12:23)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:35:30)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-08T23:33:42.344Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.344Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.344Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.345Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.345Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.345Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.345Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.345Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.853Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.received","EventType":"onMessageAdded","ConversationSid":"CH456"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.853Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot","ConversationSid":"CH456","botIdentity":"BotUser","trigger":"onMessageAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.854Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot.ok","ConversationSid":"CH456","trigger":"onMessageAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.857Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.857Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.857Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.858Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.858Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.858Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.858Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.858Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.858Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.858Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.858Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"BotUser"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-08T23:33:42.859Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"Failed to initialize Twilio Conversations client","error":"Cannot read properties of undefined (reading 'AccessToken')"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at TwilioIngressClient.start (src/services/ingress/twilio/twilio-ingress-client.ts:230:14)
      at TwilioConnectorAdapter.start (src/services/ingress/twilio/connector-adapter.ts:12:23)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:35:30)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-08T23:33:42.859Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.859Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.859Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.859Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.859Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.859Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.859Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:42.859Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.362Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.received","EventType":"onMessageAdded","ConversationSid":"CH789"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.362Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot","ConversationSid":"CH789","botIdentity":"BotUser","trigger":"onMessageAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.363Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot.already_participant","ConversationSid":"CH789","trigger":"onMessageAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.365Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.365Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.365Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.366Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.366Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.366Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.366Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.367Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.367Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.367Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.367Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"BotUser"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-08T23:33:43.367Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"Failed to initialize Twilio Conversations client","error":"Cannot read properties of undefined (reading 'AccessToken')"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at TwilioIngressClient.start (src/services/ingress/twilio/twilio-ingress-client.ts:230:14)
      at TwilioConnectorAdapter.start (src/services/ingress/twilio/connector-adapter.ts:12:23)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:35:30)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-08T23:33:43.367Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.367Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.367Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.367Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.367Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.367Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.367Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.367Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-08T23:33:43.874Z","service":"ingress-egress","level":"warn","severity":"WARNING","msg":"twilio.webhook.invalid_signature","url":"http://127.0.0.1:57168/webhooks/twilio"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at src/apps/ingress-egress-service.ts:170:20
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:57:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:132:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)
    console.log
      {"ts":"2026-01-08T23:33:43.877Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:43.877Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.instance-memory.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:44.023Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:44.024Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:44.024Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:44.025Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:45.084Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:45.085Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:45.085Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.personality.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:45.453Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:45.454Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:45.454Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:45.455Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/scheduler-service.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:46.291Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.294Z","service":"scheduler","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.294Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.299Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.300Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.300Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/tick"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.300Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.300Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"list_schedules"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.300Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"get_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.300Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"create_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.300Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"update_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.301Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"delete_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.301Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:46.387Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.388Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.388Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:46.388Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.054Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.no_prompt","correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.055Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.055Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.055Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/oauth/routes.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:47.201Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.start","provider":"mockprov","identity":"bot","mode":"json"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.206Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.start","provider":"mockprov","identity":"bot","mode":"redirect"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-08T23:33:47.210Z","service":"bitbrat","level":"error","severity":"ERROR","msg":"oauth.routes.start.error","error":"unknown_provider:unknown"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at src/services/oauth/routes.ts:43:14
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at app.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)
    console.log
      {"ts":"2026-01-08T23:33:47.218Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.callback.success","provider":"mockprov","identity":"bot","stored":false,"tokenType":"***"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.229Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.status","provider":"mockprov","identity":"bot","status":"absent"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.233Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.callback.success","provider":"mockprov","identity":"bot","stored":true,"tokenType":"***"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.236Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.status","provider":"mockprov","identity":"bot","status":"present"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/services/llm-bot/mcp/client-manager.spec.ts
PASS tests/apps/scheduler-service.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:47.787Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.789Z","service":"scheduler","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.789Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.791Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.792Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.792Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/tick"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.792Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.792Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"list_schedules"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.792Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"get_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.792Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"create_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.792Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"update_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.792Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"delete_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.792Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.802Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.tick.http_received"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.802Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.tick.executing","count":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.802Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.executing_event","id":"sched-1","type":"test.event","correlationId":"975d81a2-2cfe-435f-b0a1-c9e88e9d5fe5"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.810Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.810Z","service":"scheduler","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.811Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.812Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.812Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.812Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/tick"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.812Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.813Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"list_schedules"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.813Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"get_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.813Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"create_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.813Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"update_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.813Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"delete_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.813Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.815Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.tick.http_received"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.815Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.tick.executing","count":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.815Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.executing_event","id":"sched-once","type":"once.event","correlationId":"ce7b4814-1800-4f80-b7ff-11c6ee2827cd"}
      at Logger.info (src/common/logging.ts:142:13)
(node:83225) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGTERM listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
(node:83225) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGINT listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:83225) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 beforeExit listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:83225) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 exit listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
PASS tests/common/mcp-server.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:47.912Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.913Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.913Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.916Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.916Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.918Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.919Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.923Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.923Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.923Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.924Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.924Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.924Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.925Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.925Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.927Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.928Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.929Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.929Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.929Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.929Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.930Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.930Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.931Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.931Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-08T23:33:47.932Z","service":"test-mcp-server","level":"warn","severity":"WARNING","msg":"mcp_server.auth_failed","path":"/sse","ip":"::ffff:127.0.0.1"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at authMiddleware (src/common/mcp-server.ts:206:28)
      at src/common/mcp-server.ts:218:7
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at app.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)
    console.log
      {"ts":"2026-01-08T23:33:47.934Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.934Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.935Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.935Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.935Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.935Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.936Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.937Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-08T23:33:47.938Z","service":"test-mcp-server","level":"warn","severity":"WARNING","msg":"mcp_server.auth_failed","path":"/sse","ip":"::ffff:127.0.0.1"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at authMiddleware (src/common/mcp-server.ts:206:28)
      at src/common/mcp-server.ts:218:7
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at app.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)
    console.log
      {"ts":"2026-01-08T23:33:47.940Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.940Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.940Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.941Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.941Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.941Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.942Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.942Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.950Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.950Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.951Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.951Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.951Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.952Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.952Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.952Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.953Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.953Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.955Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.956Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.957Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.957Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.957Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.957Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.958Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.958Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.959Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.959Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.959Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.959Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.959Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.960Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.960Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.960Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.960Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.960Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.961Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.961Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.961Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.962Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.962Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.962Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"test_tool"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.963Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.963Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.963Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.963Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.963Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.963Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.964Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.964Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.965Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.resource_registered","name":"test_resource","uri":"file://test"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.965Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.965Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.965Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.966Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.966Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.966Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.967Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.967Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.968Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.prompt_registered","name":"test_prompt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.968Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.968Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:47.968Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.memory.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:48.057Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:48.060Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:48.060Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:48.061Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:48.731Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:48.731Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:48.731Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:48.807Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:48.807Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:48.807Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/apps/scheduler-service-schema-check.spec.ts
  ‚óè Console
    console.log
      CREATE SCHEMA: {
        "type": "object",
        "properties": {
          "title": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "schedule": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "once",
                  "cron"
                ]
              },
              "value": {
                "type": "string",
                "description": "ISO timestamp for 'once', or Cron expression for 'cron'"
              }
            },
            "required": [
              "type",
              "value"
            ],
            "additionalProperties": false
          },
          "event": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "description": "InternalEventType for the produced event"
              },
              "payload": {
                "type": "object",
                "additionalProperties": {},
                "description": "Payload for the InternalEventV2"
              },
              "message": {
                "type": "object",
                "properties": {
                  "text": {
                    "type": "string"
                  },
                  "role": {
                    "type": "string",
                    "enum": [
                      "user",
                      "assistant",
                      "system",
                      "tool"
                    ],
                    "default": "system"
                  }
                },
                "additionalProperties": false,
                "description": "Optional message metadata"
              },
              "annotations": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": {}
                },
                "description": "Optional annotations"
              }
            },
            "required": [
              "type"
            ],
            "additionalProperties": false
          },
          "enabled": {
            "type": "boolean",
            "default": true
          }
        },
        "required": [
          "title",
          "schedule",
          "event"
        ],
        "additionalProperties": false,
        "$schema": "http://json-schema.org/draft-07/schema#"
      }
      at Object.<anonymous> (tests/apps/scheduler-service-schema-check.spec.ts:63:13)
PASS src/services/llm-bot/processor.error.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:49.202Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:49.203Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:49.203Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:49.203Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-08T23:33:49.849Z","service":"test-llm-bot","level":"error","severity":"ERROR","msg":"llm_bot.processor.error","correlationId":"c-error","error":"boom","stack":"Error: boom\n    at Object.callLLM (/Users/christophernavta/IdeaProjects/BitBratPlatform/src/services/llm-bot/processor.error.spec.ts:27:15)\n    at processEvent (/Users/christophernavta/IdeaProjects/BitBratPlatform/src/services/llm-bot/processor.ts:276:34)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/christophernavta/IdeaProjects/BitBratPlatform/src/services/llm-bot/processor.error.spec.ts:25:20)"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at processEvent (src/services/llm-bot/processor.ts:391:12)
      at Object.<anonymous> (src/services/llm-bot/processor.error.spec.ts:25:20)
PASS tests/services/llm-bot/personality-with-memory.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:49.911Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.personality-disabled.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:50.729Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:50.730Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:50.731Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:50.731Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.empty-response.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:51.473Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:51.474Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:51.474Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:51.474Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:52.133Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:52.133Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:52.133Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/services/llm-bot/mcp/web-search.test.ts
  ‚óè Console
    console.log
      mcp_search_web schema: {
        "jsonSchema": {
          "type": "object",
          "properties": {
            "query": {
              "type": "string"
            },
            "limit": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10
            }
          },
          "required": [
            "query"
          ],
          "additionalProperties": false,
          "$schema": "http://json-schema.org/draft-07/schema#"
        }
      }
      at Object.<anonymous> (tests/services/llm-bot/mcp/web-search.test.ts:37:13)
PASS src/apps/ingress-egress-service.finalize.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:53.096Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.098Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.098Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.098Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.098Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.099Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.099Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-08T23:33:53.144Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"connector.start_error","name":"twitch","error":"twitch_auth_missing"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:39:34)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-08T23:33:53.144Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.144Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.144Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-5whi81ou","queue":"ingress-egress.proc-5whi81ou"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.144Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-5whi81ou"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.144Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.144Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.144Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.144Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.145Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.145Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.145Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"fx-1","candidateId":"c1","priority":1,"createdAt":"2026-01-08T23:33:53.145Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.145Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"fx-1","source":"","isDiscord":false,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.145Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"fx-1","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/ingress-egress-service.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:53.251Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.252Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.253Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.253Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.253Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.254Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.254Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.254Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.254Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.254Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.254Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.254Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.254Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.255Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.255Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/ingress-egress-service.krevision.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:53.379Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.380Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.380Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.381Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.394Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.400Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.400Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.400Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.400Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.400Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.400Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.400Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.400Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.401Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.401Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tools/brat/src/orchestration/exec.spec.ts
PASS src/services/message-bus/__tests__/pubsub-subscriber.ensure.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:53.856Z","service":"bitbrat","level":"info","severity":"INFO","msg":"pubsub.client.init","apiEndpoint":"default","projectId":"auto"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.857Z","service":"bitbrat","level":"info","severity":"INFO","msg":"message_consumer.subscribe.start","driver":"pubsub","topic":"internal.ingress.v1","subscription":"internal.ingress.v1.router","ackDeadline":60}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.857Z","service":"bitbrat","level":"info","severity":"INFO","msg":"pubsub.subscription.created","topic":"internal.ingress.v1","subscription":"internal.ingress.v1.router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.857Z","service":"bitbrat","level":"info","severity":"INFO","msg":"message_consumer.subscribe.ready","driver":"pubsub","subscription":"internal.ingress.v1.router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.877Z","service":"bitbrat","level":"info","severity":"INFO","msg":"pubsub.client.init","apiEndpoint":"default","projectId":"auto"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.877Z","service":"bitbrat","level":"info","severity":"INFO","msg":"message_consumer.subscribe.start","driver":"pubsub","topic":"internal.ingress.v1","subscription":"internal.ingress.v1.router","ackDeadline":60}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.877Z","service":"bitbrat","level":"info","severity":"INFO","msg":"message_consumer.subscribe.ready","driver":"pubsub","subscription":"internal.ingress.v1.router"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/oauth-service.oauth-routes.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:53.945Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.946Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.946Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:53.947Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/apps/command-processor-error-policy.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:54.028Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.028Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.028Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.029Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.029Z","service":"command-processor","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.029Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.029Z","service":"command-processor","level":"info","severity":"INFO","msg":"command_processor.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.030Z","service":"command-processor","level":"info","severity":"INFO","msg":"regex_cache.start"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.047Z","service":"command-processor","level":"info","severity":"INFO","msg":"command_processor.regex_cache.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.047Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.047Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.047Z","service":"command-processor","level":"info","severity":"INFO","msg":"command_processor.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-08T23:33:54.075Z","service":"command-processor","level":"error","severity":"ERROR","msg":"base_server.message.handler_error","subject":"dev.internal.command.v1","error":"Expected property name or '}' in JSON at position 1 (line 1 column 2)"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at subscriber.subscribe (src/common/base-server.ts:311:25)
      at Object.<anonymous> (tests/apps/command-processor-error-policy.spec.ts:62:5)
PASS tools/brat/src/cli/__tests__/deploy-substitutions.scaling.test.ts
PASS src/common/base-server.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:54.400Z","service":"test-svc","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.401Z","service":"test-svc","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.401Z","service":"test-svc","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.416Z","service":"custom","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.416Z","service":"custom","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.416Z","service":"custom","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
ReferenceError: You are trying to `import` a file after the Jest environment has been torn down. From tests/apps/command-processor-error-policy.spec.ts.
      at Firestore.get (node_modules/@google-cloud/firestore/build/src/index.js:1540:16)
      at ClientPool.clientFactory (node_modules/@google-cloud/firestore/build/src/index.js:526:45)
      at ClientPool.acquire (node_modules/@google-cloud/firestore/build/src/pool.js:121:35)
      at ClientPool.run (node_modules/@google-cloud/firestore/build/src/pool.js:260:29)
      at node_modules/@google-cloud/firestore/build/src/index.js:1412:30
      at Firestore._retry (node_modules/@google-cloud/firestore/build/src/index.js:1270:30)
PASS src/common/base-server.debug-config.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:54.648Z","service":"test-svc","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.648Z","service":"test-svc","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.648Z","service":"test-svc","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/common/__tests__/base-server-helpers.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:54.723Z","service":"test","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.724Z","service":"test","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.724Z","service":"test","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.725Z","service":"test","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/ping"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.725Z","service":"test","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/echo"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.740Z","service":"test","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.740Z","service":"test","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.740Z","service":"test","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS infrastructure/scripts/extract-config.test.ts
PASS tests/services/command-processor/routing-advance.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:54.944Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.947Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.947Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.947Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.948Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.979Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:54.979Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.029Z","service":"command-processor","level":"info","severity":"INFO","msg":"routing.next.published","subject":"dev.internal.egress.v1","stepIndex":1,"attempt":0,"correlationId":"c-adv-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.031Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.031Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.031Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.031Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.031Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.031Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.032Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.033Z","service":"command-processor","level":"info","severity":"INFO","msg":"routing.next.fallback_egress","dest":"dev.internal.egress.v1.dev1","correlationId":"c-adv-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.034Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.034Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.034Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.034Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.034Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.035Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.035Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/base-server-routing.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:55.265Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.265Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.265Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.266Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.next.published","subject":"internal.bot.requests.v1","stepIndex":1,"attempt":0,"correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.267Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.267Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.267Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.267Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.next.published","subject":"internal.step2.v1","stepIndex":1,"attempt":0,"correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.268Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.268Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.268Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.268Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.next.fallback_egress","dest":"internal.egress.v1","correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.269Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.269Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.269Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.270Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.complete.published","dest":"internal.egress.v1","correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.270Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.270Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.270Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.271Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.complete.published","dest":"internal.egress.v1","correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.271Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.271Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.271Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.272Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.next.published","subject":"internal.bot.requests.v1","stepIndex":0,"attempt":0,"correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.272Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.272Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.272Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.290Z","service":"test-service","level":"info","severity":"INFO","msg":"routing.next.published","subject":"internal.bot.requests.v1","stepIndex":0,"attempt":1,"correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/oauth-service.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:55.365Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.365Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.366Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.366Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/services/command-processor/processor.spec.ts
  ‚óè Console
    console.warn
      {"ts":"2026-01-08T23:33:55.592Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/processor.spec.ts:30:35)
    console.log
      {"ts":"2026-01-08T23:33:55.593Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"ping","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.593Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"ping","id":"cmd1","kind":"command"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.593Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.template.chosen","name":"ping","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.593Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.candidate.added","name":"ping","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-08T23:33:55.594Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/processor.spec.ts:56:35)
    console.log
      {"ts":"2026-01-08T23:33:55.594Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"note","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.594Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"note","id":"cmdA","kind":"command"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.594Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.effect.added","effect":"annotation","name":"note","kind":"prompt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-08T23:33:55.595Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/processor.spec.ts:79:35)
    console.log
      {"ts":"2026-01-08T23:33:55.595Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"cool","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.595Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"cool","id":"cmd3","kind":"command"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-08T23:33:55.595Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/processor.spec.ts:99:35)
    console.log
      {"ts":"2026-01-08T23:33:55.596Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"missing","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-08T23:33:55.596Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/processor.spec.ts:118:35)
    console.log
      {"ts":"2026-01-08T23:33:55.596Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"rate","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:55.596Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"rate","id":"cmd2","kind":"command"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-08T23:33:55.597Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/processor.spec.ts:147:35)
PASS tests/services/llm-bot/history-redundancy.test.ts
ReferenceError: You are trying to `import` a file after the Jest environment has been torn down. From tests/services/command-processor/routing-advance.spec.ts.
      at Firestore.get (node_modules/@google-cloud/firestore/build/src/index.js:1540:16)
      at ClientPool.clientFactory (node_modules/@google-cloud/firestore/build/src/index.js:526:45)
      at ClientPool.acquire (node_modules/@google-cloud/firestore/build/src/pool.js:121:35)
      at ClientPool.run (node_modules/@google-cloud/firestore/build/src/pool.js:260:29)
      at node_modules/@google-cloud/firestore/build/src/index.js:1412:30
      at Firestore._retry (node_modules/@google-cloud/firestore/build/src/index.js:1270:30)
PASS tests/services/command-processor/command-repo.spec.ts
PASS src/services/oauth/oauth-flow.integration.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:56.068Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.start","provider":"twitch","identity":"bot","mode":"redirect"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.072Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.start","provider":"twitch","identity":"bot","mode":"json"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.076Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.callback.success","provider":"twitch","identity":"bot","stored":true,"tokenType":"***","providerUserId":"u-123"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.079Z","service":"bitbrat","level":"info","severity":"INFO","msg":"oauth.routes.status","provider":"twitch","identity":"bot","status":"present"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/message-bus/nats-driver.test.ts
PASS tests/llm-bot-service.spec.ts
PASS src/apps/auth-service.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:56.543Z","service":"auth","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.544Z","service":"auth","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.544Z","service":"auth","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.545Z","service":"auth","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/counters"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/__tests__/event-router-debug.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:56.617Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.618Z","service":"event-router","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.618Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.619Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/counters"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.619Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.619Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.subscribe.start","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.619Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.622Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.622Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.subscribe.ok","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.626Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.626Z","service":"event-router","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.626Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.626Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/counters"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.626Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.627Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.subscribe.start","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.627Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.627Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.627Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.subscribe.ok","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:56.632Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.publish.ok","subject":"dev.internal.router.dlq.v1","selectedTopic":"internal.router.dlq.v1"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tools/brat/src/cli/trigger.spec.ts
PASS tests/services/command-processor/personality-annotation-regex.spec.ts
  ‚óè Console
    console.warn
      {"ts":"2026-01-08T23:33:57.058Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/personality-annotation-regex.spec.ts:42:35)
    console.log
      {"ts":"2026-01-08T23:33:57.059Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"hello-cmd","id":"regex-1","kind":"regex"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.059Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.template.chosen","name":"hello-cmd","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.059Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.candidate.added","name":"hello-cmd","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.059Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.personality.added","id":"regex-1","command":"hello-cmd","personality":"friendly"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/persistence/integration.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-08T23:33:57.282Z","service":"persistence","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.284Z","service":"persistence","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.284Z","service":"persistence","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.284Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.subscribe.ok","destination":"internal.ingress.v1","queue":"persistence"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.284Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.subscribe.ok","destination":"internal.persistence.finalize.v1","queue":"persistence"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.284Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.subscribe.ok","destination":"internal.deadletter.v1","queue":"persistence"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.284Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.subscribe.ok","destination":"internal.router.dlq.v1","queue":"persistence"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.285Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.message.received","destination":"internal.ingress.v1","type":"chat.message.v1","correlationId":"it-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.285Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.upsert.ok","correlationId":"it-1","status":"INGESTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.287Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.message.received","destination":"internal.persistence.finalize.v1","correlationId":"it-2"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.287Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.finalize.ok","correlationId":"it-2","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.287Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.message.received","destination":"internal.persistence.finalize.v1","correlationId":"it-3"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.288Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.finalize.ok","correlationId":"it-3","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.288Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.message.received","destination":"internal.persistence.finalize.v1","correlationId":"it-ttl-seconds"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-08T23:33:57.288Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.finalize.ok","correlationId":"it-ttl-seconds","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
LINE LIMIT EXCEEDED