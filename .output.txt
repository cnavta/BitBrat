To address issues that do not require attention, run:
  npm audit fix
To address all issues (including breaking changes), run:
  npm audit fix --force
Run `npm audit` for details.
üß± Compiling...
> bitbrat-platform@1.0.0 build
> tsc -p tsconfig.json
üß™ Running tests (scope=all)...
üîí Discord validation state: DISCORD_ENABLED=false
> bitbrat-platform@1.0.0 test
> jest
PASS src/apps/__tests__/ingress-egress-routing.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:55:51.216Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.218Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.218Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.218Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.218Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.220Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.221Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.230Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.230Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.230Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.230Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-nto6i9wl","queue":"ingress-egress.proc-nto6i9wl"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-nto6i9wl","queue":"ingress-egress.proc-nto6i9wl"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-nto6i9wl","queue":"ingress-egress.proc-nto6i9wl"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-nto6i9wl"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.231Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.232Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.232Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.232Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.232Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.734Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-1","candidateId":"cand-1","priority":1,"createdAt":"2026-01-15T15:55:51.733Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.737Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-1","source":"ingress.discord","isDiscord":true,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.737Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-1","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.739Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.740Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.740Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.740Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.740Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.740Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.740Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.740Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.740Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.740Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.740Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.741Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.741Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-v50rpfw0","queue":"ingress-egress.proc-v50rpfw0"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.741Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-v50rpfw0","queue":"ingress-egress.proc-v50rpfw0"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.741Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-v50rpfw0","queue":"ingress-egress.proc-v50rpfw0"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.741Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-v50rpfw0"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.741Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.741Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.741Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.741Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.741Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.741Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:51.742Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.242Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-3","candidateId":"cand-3","priority":1,"createdAt":"2026-01-15T15:55:52.242Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.243Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-3","source":"command-processor","isDiscord":true,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.243Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-3","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.244Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.244Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.244Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.244Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.244Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.244Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.244Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.244Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-4jle4m12","queue":"ingress-egress.proc-4jle4m12"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-4jle4m12","queue":"ingress-egress.proc-4jle4m12"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-4jle4m12","queue":"ingress-egress.proc-4jle4m12"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-4jle4m12"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.245Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.746Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-v1","source":"ingress.discord","isDiscord":true,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.747Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-v1","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.749Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.749Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.750Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.750Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.750Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.751Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.751Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.751Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.751Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.751Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.751Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.751Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.751Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-7h6vwbka","queue":"ingress-egress.proc-7h6vwbka"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.751Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-7h6vwbka","queue":"ingress-egress.proc-7h6vwbka"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.752Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-7h6vwbka","queue":"ingress-egress.proc-7h6vwbka"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.752Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-7h6vwbka"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.752Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.752Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.752Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.752Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.752Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.752Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:52.752Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.255Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-2","candidateId":"cand-2","priority":1,"createdAt":"2026-01-15T15:55:53.255Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.256Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-2","source":"ingress.twitch","isDiscord":false,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.256Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-2","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.258Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.259Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.259Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.260Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.261Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.261Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.261Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.261Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.261Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.261Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.261Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.261Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.261Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-eeznnx2j","queue":"ingress-egress.proc-eeznnx2j"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.262Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-eeznnx2j","queue":"ingress-egress.proc-eeznnx2j"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.262Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.egress.v1.proc-eeznnx2j","queue":"ingress-egress.proc-eeznnx2j"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.262Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-eeznnx2j"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.262Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.262Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.262Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.262Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.262Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.262Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.262Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.763Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-twilio","candidateId":"cand-twilio","priority":1,"createdAt":"2026-01-15T15:55:53.763Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.764Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-twilio","source":"ingress.twilio","isDiscord":false,"isTwilio":true}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:53.764Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-twilio","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/services/llm-bot/mcp/web-search.test.ts
  ‚óè Console
    console.log
      mcp_search_web schema: {
        "jsonSchema": {
          "type": "object",
          "properties": {
            "query": {
              "type": "string"
            },
            "limit": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10
            }
          },
          "required": [
            "query"
          ],
          "additionalProperties": false,
          "$schema": "http://json-schema.org/draft-07/schema#"
        }
      }
      at Object.<anonymous> (tests/services/llm-bot/mcp/web-search.test.ts:37:13)
PASS src/apps/__tests__/ingress-egress-webhooks.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:55:54.880Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.880Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.881Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.881Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.881Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.882Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.882Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.882Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.882Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.883Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.883Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.883Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"BotUser"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T15:55:54.993Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"Failed to initialize Twilio Conversations client","error":"Cannot read properties of undefined (reading 'AccessToken')"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at TwilioIngressClient.start (src/services/ingress/twilio/twilio-ingress-client.ts:230:14)
      at TwilioConnectorAdapter.start (src/services/ingress/twilio/connector-adapter.ts:12:23)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:35:30)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-15T15:55:54.993Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.993Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.993Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.993Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.993Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.994Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.994Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:54.994Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.401Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.received","EventType":"onConversationAdded","ConversationSid":"CH123"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.401Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot","ConversationSid":"CH123","botIdentity":"BotUser","trigger":"onConversationAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.402Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot.ok","ConversationSid":"CH123","trigger":"onConversationAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.406Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.406Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.406Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.406Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.407Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.407Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.407Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.407Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.407Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.407Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.407Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"BotUser"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T15:55:55.407Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"Failed to initialize Twilio Conversations client","error":"Cannot read properties of undefined (reading 'AccessToken')"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at TwilioIngressClient.start (src/services/ingress/twilio/twilio-ingress-client.ts:230:14)
      at TwilioConnectorAdapter.start (src/services/ingress/twilio/connector-adapter.ts:12:23)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:35:30)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-15T15:55:55.407Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.407Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.408Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.408Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.408Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.408Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.408Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.408Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.912Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.received","EventType":"onMessageAdded","ConversationSid":"CH456"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.912Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot","ConversationSid":"CH456","botIdentity":"BotUser","trigger":"onMessageAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.912Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot.ok","ConversationSid":"CH456","trigger":"onMessageAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.914Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.914Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.915Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.915Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.915Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.915Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.915Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.915Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.916Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.916Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.916Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"BotUser"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T15:55:55.916Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"Failed to initialize Twilio Conversations client","error":"Cannot read properties of undefined (reading 'AccessToken')"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at TwilioIngressClient.start (src/services/ingress/twilio/twilio-ingress-client.ts:230:14)
      at TwilioConnectorAdapter.start (src/services/ingress/twilio/connector-adapter.ts:12:23)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:35:30)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-15T15:55:55.916Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.916Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.916Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.916Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.916Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.916Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.916Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:55.916Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.420Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.received","EventType":"onMessageAdded","ConversationSid":"CH789"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.420Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot","ConversationSid":"CH789","botIdentity":"BotUser","trigger":"onMessageAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.420Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.webhook.inject_bot.already_participant","ConversationSid":"CH789","trigger":"onMessageAdded"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.422Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.422Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.423Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.423Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.423Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twilio.init_ok"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.423Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/webhooks/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.423Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.423Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.423Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.423Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.424Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"BotUser"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T15:55:56.424Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"Failed to initialize Twilio Conversations client","error":"Cannot read properties of undefined (reading 'AccessToken')"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at TwilioIngressClient.start (src/services/ingress/twilio/twilio-ingress-client.ts:230:14)
      at TwilioConnectorAdapter.start (src/services/ingress/twilio/connector-adapter.ts:12:23)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:35:30)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-15T15:55:56.424Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.424Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.424Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.424Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.424Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.424Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.424Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.424Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twilio","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T15:55:56.928Z","service":"ingress-egress","level":"warn","severity":"WARNING","msg":"twilio.webhook.invalid_signature","url":"http://127.0.0.1:51975/webhooks/twilio"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at src/apps/ingress-egress-service.ts:170:20
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:57:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:132:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)
    console.log
      {"ts":"2026-01-15T15:55:56.932Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:56.932Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/apps/scheduler-service.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:55:57.521Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.522Z","service":"scheduler","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.522Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.527Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.527Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.528Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/tick"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.528Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.528Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"list_schedules"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.528Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"get_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.528Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"create_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.528Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"update_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.528Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"delete_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.528Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.531Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.tick.http_received"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.531Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.tick.executing","count":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.531Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.executing_event","id":"sched-1","type":"test.event","correlationId":"97baccaa-99e3-4ccc-a5c3-982f70066cfb"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.539Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.539Z","service":"scheduler","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.539Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.541Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.541Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.541Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/tick"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.541Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.542Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"list_schedules"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.542Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"get_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.542Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"create_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.542Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"update_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.542Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"delete_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.542Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.549Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.tick.http_received"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.550Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.tick.executing","count":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.550Z","service":"scheduler","level":"info","severity":"INFO","msg":"scheduler.executing_event","id":"sched-once","type":"once.event","correlationId":"321bc57e-8e4a-458b-8cc6-35e739672d63"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/ingress/twitch/__tests__/eventsub-client.repro.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:55:57.746Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.starting","channels":["broadcaster"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.747Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.aliasing_bot_token","broadcasterId":"broadcaster-id","botId":"bot-id"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.747Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.748Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.starting","channels":["broadcaster"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.748Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.aliasing_bot_token","broadcasterId":"broadcaster-id","botId":"bot-id"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.748Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.749Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.starting","channels":["realbroadcaster"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.749Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.broadcaster_auth_found","userId":"real-broadcaster-id"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.749Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.750Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.starting","channels":["broadcaster"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.750Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.aliasing_bot_token","broadcasterId":"broadcaster-id","botId":"bot-id"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.750Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.750Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.event.stream_online","channel":"broadcaster","streamId":"12345"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.751Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.starting","channels":["broadcaster"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.751Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.aliasing_bot_token","broadcasterId":"broadcaster-id","botId":"bot-id"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.751Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T15:55:57.757Z","service":"bitbrat","level":"error","severity":"ERROR","msg":"twitch.eventsub.handler_error","kind":"stream.online","channel":"broadcaster","error":"Cannot read properties of null (reading 'id')","stack":"TypeError: Cannot read properties of null (reading 'id')\n    at /Users/christophernavta/IdeaProjects/BitBratPlatform/src/services/ingress/twitch/eventsub-client.ts:170:91\n    at Object.<anonymous> (/Users/christophernavta/IdeaProjects/BitBratPlatform/src/services/ingress/twitch/__tests__/eventsub-client.repro.spec.ts:210:11)"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at src/services/ingress/twitch/eventsub-client.ts:178:20
      at Object.<anonymous> (src/services/ingress/twitch/__tests__/eventsub-client.repro.spec.ts:210:11)
    console.log
      {"ts":"2026-01-15T15:55:57.757Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.starting","channels":["broadcaster"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.757Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.aliasing_bot_token","broadcasterId":"broadcaster-id","botId":"bot-id"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.757Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:57.757Z","service":"bitbrat","level":"info","severity":"INFO","msg":"twitch.eventsub.stopped"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tools/brat/src/providers/cdktf-synth.loadbalancer.routing.test.ts
  ‚óè Console
    console.log
      {"component":"brat","action":"config.interpolate","vars_used":[],"unresolved":[],"notice":"Set BITBRAT_INTERPOLATION=0 to disable interpolation temporarily"}
      at loadArchitecture (tools/brat/src/config/loader.ts:151:15)
    console.log
      {"component":"brat","action":"config.interpolate","vars_used":[],"unresolved":[],"notice":"Set BITBRAT_INTERPOLATION=0 to disable interpolation temporarily"}
      at loadArchitecture (tools/brat/src/config/loader.ts:151:15)
    console.log
      {"component":"brat","action":"config.interpolate","vars_used":[],"unresolved":[],"notice":"Set BITBRAT_INTERPOLATION=0 to disable interpolation temporarily"}
      at loadArchitecture (tools/brat/src/config/loader.ts:151:15)
    console.log
      {"component":"brat","action":"config.interpolate","vars_used":[],"unresolved":[],"notice":"Set BITBRAT_INTERPOLATION=0 to disable interpolation temporarily"}
      at loadArchitecture (tools/brat/src/config/loader.ts:151:15)
    console.log
      {"component":"brat","action":"config.interpolate","vars_used":[],"unresolved":[],"notice":"Set BITBRAT_INTERPOLATION=0 to disable interpolation temporarily"}
      at loadArchitecture (tools/brat/src/config/loader.ts:151:15)
PASS tools/brat/src/config/schema.routing.test.ts
PASS src/services/auth/__tests__/enrichment.spec.ts
PASS src/services/persistence/store.spec.ts
PASS src/apps/__tests__/command-processor-service.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:55:59.096Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:59.096Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:59.097Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:59.097Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:59.097Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:59.163Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:55:59.163Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T15:55:59.194Z","service":"command-processor","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at exec (src/apps/command-processor-service.ts:66:28)
      at src/apps/command-processor-service.ts:71:34
      at NoopContextManager.with (node_modules/@opentelemetry/api/src/context/NoopContextManager.ts:31:15)
      at ContextAPI.with (node_modules/@opentelemetry/api/src/api/context.ts:77:42)
      at NoopTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/NoopTracer.ts:98:27)
      at ProxyTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/ProxyTracer.ts:51:20)
      at src/apps/command-processor-service.ts:69:30
      at src/common/base-server.ts:302:39
      at src/common/tracing.ts:104:20
      at NoopContextManager.with (node_modules/@opentelemetry/api/src/context/NoopContextManager.ts:31:15)
      at ContextAPI.with (node_modules/@opentelemetry/api/src/api/context.ts:77:42)
      at NoopTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/NoopTracer.ts:98:27)
      at ProxyTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/ProxyTracer.ts:51:20)
      at startActiveSpan (src/common/tracing.ts:102:17)
      at subscriber.subscribe (src/common/base-server.ts:297:36)
      at capturedHandler (src/apps/__tests__/command-processor-service.test.ts:12:13)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:63:11)
    console.error
      {"ts":"2026-01-15T15:56:00.276Z","service":"command-processor","level":"error","severity":"ERROR","msg":"command_repo.findFirstByCommandTerm.error","term":"ping","error":"7 PERMISSION_DENIED: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at findFirstByCommandTerm (src/services/command-processor/command-repo.ts:143:12)
      at processEvent (src/services/command-processor/processor.ts:175:9)
      at exec (src/apps/command-processor-service.ts:66:22)
      at src/apps/command-processor-service.ts:71:28
      at src/apps/command-processor-service.ts:69:17
      at src/common/base-server.ts:302:17
      at src/common/tracing.ts:104:14
      at subscriber.subscribe (src/common/base-server.ts:297:15)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:63:5)
    console.error
      {"ts":"2026-01-15T15:56:00.276Z","service":"command-processor","level":"error","severity":"ERROR","msg":"command_processor.process_error","subject":"dev.internal.command.v1","error":"7 PERMISSION_DENIED: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at src/apps/command-processor-service.ts:100:20
      at src/common/base-server.ts:302:17
      at src/common/tracing.ts:104:14
      at subscriber.subscribe (src/common/base-server.ts:297:15)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:63:5)
    console.log
      {"ts":"2026-01-15T15:56:00.277Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:00.277Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:00.277Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:00.277Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:00.277Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:00.278Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:00.278Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T15:56:00.279Z","service":"command-processor","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at exec (src/apps/command-processor-service.ts:66:28)
      at src/apps/command-processor-service.ts:71:34
      at NoopContextManager.with (node_modules/@opentelemetry/api/src/context/NoopContextManager.ts:31:15)
      at ContextAPI.with (node_modules/@opentelemetry/api/src/api/context.ts:77:42)
      at NoopTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/NoopTracer.ts:98:27)
      at ProxyTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/ProxyTracer.ts:51:20)
      at src/apps/command-processor-service.ts:69:30
      at src/common/base-server.ts:302:39
      at src/common/tracing.ts:104:20
      at NoopContextManager.with (node_modules/@opentelemetry/api/src/context/NoopContextManager.ts:31:15)
      at ContextAPI.with (node_modules/@opentelemetry/api/src/api/context.ts:77:42)
      at NoopTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/NoopTracer.ts:98:27)
      at ProxyTracer.startActiveSpan (node_modules/@opentelemetry/api/src/trace/ProxyTracer.ts:51:20)
      at startActiveSpan (src/common/tracing.ts:102:17)
      at subscriber.subscribe (src/common/base-server.ts:297:36)
      at capturedHandler (src/apps/__tests__/command-processor-service.test.ts:12:13)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:88:11)
    console.error
      {"ts":"2026-01-15T15:56:00.335Z","service":"command-processor","level":"error","severity":"ERROR","msg":"regex_cache.snapshot.error","error":"Error 7: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at QueryWatch.onError (src/services/command-processor/regex-cache.ts:150:14)
      at QueryWatch.closeStream (node_modules/@google-cloud/firestore/build/src/watch.js:227:18)
      at QueryWatch.onData (node_modules/@google-cloud/firestore/build/src/watch.js:376:22)
      at PassThrough.<anonymous> (node_modules/@google-cloud/firestore/build/src/watch.js:322:26)
      at StreamProxy.ondata (node_modules/readable-stream/lib/_stream_readable.js:629:20)
      at addChunk (node_modules/readable-stream/lib/_stream_readable.js:279:12)
      at readableAddChunk (node_modules/readable-stream/lib/_stream_readable.js:262:11)
      at StreamProxy.Object.<anonymous>.Readable.push (node_modules/readable-stream/lib/_stream_readable.js:228:10)
      at StreamProxy.Object.<anonymous>.Duplexify._forward (node_modules/duplexify/index.js:172:26)
      at ClientDuplexStreamImpl.onreadable (node_modules/duplexify/index.js:136:10)
    console.error
      {"ts":"2026-01-15T15:56:00.379Z","service":"command-processor","level":"error","severity":"ERROR","msg":"command_repo.findFirstByCommandTerm.error","term":"ping","error":"7 PERMISSION_DENIED: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at findFirstByCommandTerm (src/services/command-processor/command-repo.ts:143:12)
      at processEvent (src/services/command-processor/processor.ts:175:9)
      at exec (src/apps/command-processor-service.ts:66:22)
      at src/apps/command-processor-service.ts:71:28
      at src/apps/command-processor-service.ts:69:17
      at src/common/base-server.ts:302:17
      at src/common/tracing.ts:104:14
      at subscriber.subscribe (src/common/base-server.ts:297:15)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:88:5)
    console.error
      {"ts":"2026-01-15T15:56:00.380Z","service":"command-processor","level":"error","severity":"ERROR","msg":"command_processor.process_error","subject":"dev.internal.command.v1","error":"7 PERMISSION_DENIED: Missing or insufficient permissions."}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at src/apps/command-processor-service.ts:100:20
      at src/common/base-server.ts:302:17
      at src/common/tracing.ts:104:14
      at subscriber.subscribe (src/common/base-server.ts:297:15)
      at Object.<anonymous> (src/apps/__tests__/command-processor-service.test.ts:88:5)
PASS src/services/llm-bot/processor.instance-memory.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:00.815Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:00.815Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:00.815Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:00.816Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:01.766Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:01.766Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:01.766Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.memory.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:02.380Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:02.380Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:02.381Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:02.381Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:03.029Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:03.029Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:03.029Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:03.078Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:03.078Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:03.078Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.personality.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:03.383Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:03.383Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:03.383Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:03.384Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:04.258Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:04.258Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:04.258Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:04.259Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:05.087Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.no_prompt","correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:05.089Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:05.089Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:05.089Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/services/llm-bot/personality-with-memory.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:05.367Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.error.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:06.375Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:06.376Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:06.376Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:06.376Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T15:56:06.979Z","service":"test-llm-bot","level":"error","severity":"ERROR","msg":"llm_bot.processor.error","correlationId":"c-error","error":"boom","stack":"Error: boom\n    at Object.callLLM (/Users/christophernavta/IdeaProjects/BitBratPlatform/src/services/llm-bot/processor.error.spec.ts:27:15)\n    at processEvent (/Users/christophernavta/IdeaProjects/BitBratPlatform/src/services/llm-bot/processor.ts:276:34)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/christophernavta/IdeaProjects/BitBratPlatform/src/services/llm-bot/processor.error.spec.ts:25:20)"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at processEvent (src/services/llm-bot/processor.ts:391:12)
      at Object.<anonymous> (src/services/llm-bot/processor.error.spec.ts:25:20)
PASS src/services/llm-bot/processor.empty-response.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:07.195Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:07.196Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:07.196Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:07.196Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:07.772Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:07.772Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:07.772Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/llm-bot-service.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:08.161Z","service":"llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:08.162Z","service":"llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:08.162Z","service":"llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:08.162Z","service":"llm-bot","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.llmbot.v1","queue":"llm-bot"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:08.162Z","service":"llm-bot","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.llmbot.v1","queue":"llm-bot"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.personality-disabled.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:08.397Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:08.397Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:08.398Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:08.398Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/scheduler-service.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:09.252Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.252Z","service":"scheduler","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.252Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.254Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.255Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.255Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/tick"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.255Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.255Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"list_schedules"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.255Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"get_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.255Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"create_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.255Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"update_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.255Z","service":"scheduler","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"delete_schedule"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.256Z","service":"scheduler","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"internal.scheduler.tick","queue":"scheduler"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/services/llm-bot/mcp/client-manager.spec.ts
PASS src/apps/ingress-egress-service.finalize.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:09.775Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.776Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.776Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.776Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.776Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.776Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.777Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T15:56:09.797Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"connector.start_error","name":"twitch","error":"twitch_auth_missing"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:39:34)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:209:7)
    console.log
      {"ts":"2026-01-15T15:56:09.797Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.797Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.797Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-w9rsk94z","queue":"ingress-egress.proc-w9rsk94z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.797Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-w9rsk94z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.797Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.797Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.797Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.797Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.797Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.797Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.798Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"fx-1","candidateId":"c1","priority":1,"createdAt":"2026-01-15T15:56:09.798Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.798Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"fx-1","source":"","isDiscord":false,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:09.798Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"fx-1","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tools/brat/src/cli/trigger.spec.ts
(node:67458) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGTERM listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
(node:67458) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGINT listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:67458) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 beforeExit listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:67458) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 exit listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
PASS tests/common/mcp-server.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:10.762Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.763Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.763Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.766Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.766Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.770Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.771Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.777Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.777Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.778Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.778Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.779Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.779Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.781Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.782Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.783Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.784Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.786Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.786Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.786Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.786Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.787Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.787Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.790Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.790Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T15:56:10.793Z","service":"test-mcp-server","level":"warn","severity":"WARNING","msg":"mcp_server.auth_failed","path":"/sse","ip":"::ffff:127.0.0.1"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at authMiddleware (src/common/mcp-server.ts:187:28)
      at src/common/mcp-server.ts:199:7
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at app.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)
    console.log
      {"ts":"2026-01-15T15:56:10.795Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.795Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.795Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.796Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.796Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.796Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.799Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.799Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T15:56:10.801Z","service":"test-mcp-server","level":"warn","severity":"WARNING","msg":"mcp_server.auth_failed","path":"/sse","ip":"::ffff:127.0.0.1"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at authMiddleware (src/common/mcp-server.ts:187:28)
      at src/common/mcp-server.ts:199:7
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at app.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)
    console.log
      {"ts":"2026-01-15T15:56:10.804Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.804Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.804Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.805Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.805Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.805Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.807Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.808Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.809Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.810Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.812Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.812Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.812Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.813Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.813Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.813Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.816Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.816Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.818Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.819Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.820Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.820Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.820Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.821Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.821Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.822Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.824Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.824Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.825Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.825Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.826Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.826Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.826Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.827Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.827Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.828Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.828Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.829Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.829Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.832Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.832Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.833Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"test_tool"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.833Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.834Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.834Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.835Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.835Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.835Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.838Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.838Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.838Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.resource_registered","name":"test_resource","uri":"file://test"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.839Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.839Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.839Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.840Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.840Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.840Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.845Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.846Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.846Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.prompt_registered","name":"test_prompt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.847Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.847Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:10.847Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/llm-bot-service.spec.ts
PASS tests/services/llm-bot/mcp/bridge.spec.ts
PASS tools/brat/src/cli/__tests__/deploy-substitutions.scaling.test.ts
PASS src/apps/ingress-egress-service.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:11.910Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.910Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.910Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.911Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.911Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.911Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.912Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.912Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.912Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.912Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.912Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.912Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.912Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.912Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:11.912Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/tools/__tests__/internal-tools.test.ts
PASS src/apps/ingress-egress-service.krevision.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:12.392Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.392Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.392Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.392Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"noop","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.408Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"twitch.eventsub.disabled","reason":"config or test env"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twilio"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.414Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/common/__tests__/base-server-helpers.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:12.639Z","service":"test","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.640Z","service":"test","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.640Z","service":"test","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.640Z","service":"test","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/ping"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.640Z","service":"test","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/echo"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.651Z","service":"test","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.651Z","service":"test","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.651Z","service":"test","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/apps/command-processor-error-policy.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:12.868Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.868Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.868Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.868Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.869Z","service":"command-processor","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.869Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.869Z","service":"command-processor","level":"info","severity":"INFO","msg":"command_processor.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.869Z","service":"command-processor","level":"info","severity":"INFO","msg":"regex_cache.start"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.886Z","service":"command-processor","level":"info","severity":"INFO","msg":"command_processor.regex_cache.started"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.886Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.886Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:12.886Z","service":"command-processor","level":"info","severity":"INFO","msg":"command_processor.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2026-01-15T15:56:12.914Z","service":"command-processor","level":"error","severity":"ERROR","msg":"base_server.message.handler_error","subject":"dev.internal.command.v1","error":"Expected property name or '}' in JSON at position 1 (line 1 column 2)"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at subscriber.subscribe (src/common/base-server.ts:311:25)
      at Object.<anonymous> (tests/apps/command-processor-error-policy.spec.ts:62:5)
ReferenceError: You are trying to `import` a file after the Jest environment has been torn down. From tests/apps/command-processor-error-policy.spec.ts.
      at Firestore.get (node_modules/@google-cloud/firestore/build/src/index.js:1540:16)
      at ClientPool.clientFactory (node_modules/@google-cloud/firestore/build/src/index.js:526:45)
      at ClientPool.acquire (node_modules/@google-cloud/firestore/build/src/pool.js:121:35)
      at ClientPool.run (node_modules/@google-cloud/firestore/build/src/pool.js:260:29)
      at node_modules/@google-cloud/firestore/build/src/index.js:1412:30
      at Firestore._retry (node_modules/@google-cloud/firestore/build/src/index.js:1270:30)
PASS src/apps/oauth-service.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:13.252Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.252Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.252Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.252Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/services/command-processor/routing-advance.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:13.473Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.474Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.474Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.474Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.475Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.492Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.492Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.518Z","service":"command-processor","level":"info","severity":"INFO","msg":"routing.next.published","subject":"dev.internal.egress.v1","stepIndex":1,"attempt":0,"correlationId":"c-adv-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.520Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.520Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.520Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.520Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.520Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.520Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.521Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.522Z","service":"command-processor","level":"info","severity":"INFO","msg":"routing.next.fallback_egress","dest":"dev.internal.egress.v1.dev1","correlationId":"c-adv-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.523Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.523Z","service":"command-processor","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.523Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.523Z","service":"command-processor","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.523Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.523Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.524Z","service":"command-processor","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.command.v1","queue":"command-processor"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/reducer.spec.ts
ReferenceError: You are trying to `import` a file after the Jest environment has been torn down. From tests/services/command-processor/routing-advance.spec.ts.
      at Firestore.get (node_modules/@google-cloud/firestore/build/src/index.js:1540:16)
      at ClientPool.clientFactory (node_modules/@google-cloud/firestore/build/src/index.js:526:45)
      at ClientPool.acquire (node_modules/@google-cloud/firestore/build/src/pool.js:121:35)
      at ClientPool.run (node_modules/@google-cloud/firestore/build/src/pool.js:260:29)
      at node_modules/@google-cloud/firestore/build/src/index.js:1412:30
      at Firestore._retry (node_modules/@google-cloud/firestore/build/src/index.js:1270:30)
PASS src/apps/oauth-service.oauth-routes.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:13.970Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.974Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.975Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:13.975Z","service":"oauth-flow","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
PASS infrastructure/scripts/extract-config.test.ts
PASS tests/base-server-step-update.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:14.559Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.560Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.560Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.561Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.561Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.561Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.562Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.563Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.563Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.564Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.564Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.564Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.565Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.565Z","service":"test-service","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.565Z","service":"test-service","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/auth-service.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:14.827Z","service":"auth","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.828Z","service":"auth","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.828Z","service":"auth","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:14.828Z","service":"auth","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/counters"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/__tests__/event-router-debug.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:15.117Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.117Z","service":"event-router","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.117Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.117Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/counters"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.118Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.118Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.subscribe.start","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.118Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.120Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.121Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.subscribe.ok","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.124Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.125Z","service":"event-router","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.125Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.125Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/counters"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.125Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.125Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.subscribe.start","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.125Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.125Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.125Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.subscribe.ok","subject":"dev.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.130Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.publish.ok","subject":"dev.internal.router.dlq.v1","selectedTopic":"internal.router.dlq.v1"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/apps/event-router-service.test.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:15.327Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.327Z","service":"event-router","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.327Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.327Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/counters"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.327Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.328Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.subscribe.start","subject":"test.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.328Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"test.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.332Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"test.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.332Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.subscribe.ok","subject":"test.internal.user.enriched.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.334Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.334Z","service":"event-router","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.334Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.334Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/counters"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.334Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.334Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.subscribe.start","subject":"test.internal.custom.topic.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.335Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"test.internal.custom.topic.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.335Z","service":"event-router","level":"info","severity":"INFO","msg":"base_server.message.subscribe.ok","subject":"test.internal.custom.topic.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.335Z","service":"event-router","level":"info","severity":"INFO","msg":"event_router.subscribe.ok","subject":"test.internal.custom.topic.v1","queue":"event-router"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/__tests__/processor.unwrap-quotes.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:15.545Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.546Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.546Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/persistence/integration.spec.ts
  ‚óè Console
    console.log
      {"ts":"2026-01-15T15:56:15.775Z","service":"persistence","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.776Z","service":"persistence","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.776Z","service":"persistence","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.776Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.subscribe.ok","destination":"internal.ingress.v1","queue":"persistence"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.776Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.subscribe.ok","destination":"internal.persistence.finalize.v1","queue":"persistence"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.776Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.subscribe.ok","destination":"internal.deadletter.v1","queue":"persistence"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.776Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.subscribe.ok","destination":"internal.router.dlq.v1","queue":"persistence"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.777Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.message.received","destination":"internal.ingress.v1","type":"chat.message.v1","correlationId":"it-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.777Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.upsert.ok","correlationId":"it-1","status":"INGESTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.782Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.message.received","destination":"internal.persistence.finalize.v1","correlationId":"it-2"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.782Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.finalize.ok","correlationId":"it-2","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.783Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.message.received","destination":"internal.persistence.finalize.v1","correlationId":"it-3"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.783Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.finalize.ok","correlationId":"it-3","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.783Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.message.received","destination":"internal.persistence.finalize.v1","correlationId":"it-ttl-seconds"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.783Z","service":"persistence","level":"info","severity":"INFO","msg":"persistence.finalize.ok","correlationId":"it-ttl-seconds","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
PASS tests/services/command-processor/personality-annotation.spec.ts
  ‚óè Console
    console.warn
      {"ts":"2026-01-15T15:56:15.978Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/personality-annotation.spec.ts:37:35)
    console.log
      {"ts":"2026-01-15T15:56:15.978Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"greet","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.979Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"greet","id":"cmd-p1","kind":"command"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.979Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.template.chosen","name":"greet","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.979Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.candidate.added","name":"greet","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.979Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.personality.added","id":"cmd-p1","command":"greet","personality":"snarky"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T15:56:15.980Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/personality-annotation.spec.ts:64:35)
    console.log
      {"ts":"2026-01-15T15:56:15.980Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"note","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.980Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"note","id":"cmd-p2","kind":"command"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.980Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.effect.added","effect":"annotation","name":"note","kind":"prompt"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.980Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.personality.added","id":"cmd-p2","command":"note","personality":"friendly"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T15:56:15.981Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/personality-annotation.spec.ts:83:35)
    console.log
      {"ts":"2026-01-15T15:56:15.981Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"noop","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.981Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"noop","id":"cmd-p3","kind":"command"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.981Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.template.chosen","name":"noop","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.981Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.candidate.added","name":"noop","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T15:56:15.981Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/personality-annotation.spec.ts:102:35)
    console.log
      {"ts":"2026-01-15T15:56:15.981Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"noop","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.981Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"noop","id":"cmd-p4","kind":"command"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.981Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.template.chosen","name":"noop","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.982Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.candidate.added","name":"noop","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T15:56:15.982Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.personality.invalid","id":"cmd-p4","name":"noop","value":"   "}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at maybeAppendPersonality (src/services/command-processor/processor.ts:237:16)
      at processEvent (src/services/command-processor/processor.ts:360:3)
      at Object.<anonymous> (tests/services/command-processor/personality-annotation.spec.ts:102:17)
    console.warn
      {"ts":"2026-01-15T15:56:15.982Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.config.bot_username.missing"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at processForParsing (src/services/command-processor/processor.ts:118:12)
      at processEvent (src/services/command-processor/processor.ts:165:21)
      at Object.<anonymous> (tests/services/command-processor/personality-annotation.spec.ts:109:36)
    console.log
      {"ts":"2026-01-15T15:56:15.982Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.parsed","name":"noop","args":0,"sigil":"!"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.982Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.command.matched","name":"noop","id":"cmd-p5","kind":"command"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.982Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.template.chosen","name":"noop","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2026-01-15T15:56:15.982Z","service":"bitbrat","level":"info","severity":"INFO","msg":"command_processor.candidate.added","name":"noop","templateId":"t1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2026-01-15T15:56:15.982Z","service":"bitbrat","level":"warn","severity":"WARNING","msg":"command_processor.personality.invalid","id":"cmd-p5","name":"noop","valueType":"number"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at maybeAppendPersonality (src/services/command-processor/processor.ts:232:16)
      at processEvent (src/services/command-processor/processor.ts:360:3)
      at Object.<anonymous> (tests/services/command-processor/personality-annotation.spec.ts:109:18)
LINE LIMIT EXCEEDED