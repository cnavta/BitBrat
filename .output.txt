[validate_deliverable] Notice: PROJECT_ID not provided. Will run install/build/tests only and skip infra + deployment steps.
üîß Installing dependencies...
up to date, audited 824 packages in 1s
150 packages are looking for funding
  run `npm fund` for details
4 vulnerabilities (2 moderate, 2 high)
To address all issues, run:
  npm audit fix
Run `npm audit` for details.
üß± Compiling...
> bitbrat-platform@1.0.0 build
> tsc -p tsconfig.json
üß™ Running tests (scope=llm-bot)...
üîí Discord validation state: DISCORD_ENABLED=false
> bitbrat-platform@1.0.0 test
> jest src/services/llm-bot
PASS src/services/llm-bot/processor.test.ts
  ‚óè Console
    console.log
      {"ts":"2025-12-19T16:48:53.056Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:53.058Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:53.059Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:53.069Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:54.346Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-1","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:54.346Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":0,"names":[],"versions":[],"metrics":{"resolved":0,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"","constraintsCount":0,"correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:54.349Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.no_prompt_annotations","correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:54.351Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:54.351Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:54.351Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:54.445Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-1","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:54.445Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":0,"names":[],"versions":[],"metrics":{"resolved":0,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"","constraintsCount":0,"correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2025-12-19T16:48:54.447Z","service":"test-llm-bot","level":"warn","severity":"WARNING","msg":"llm_bot.deprecation.input_context_history","correlationId":"c-1","note":"Conversation history is no longer injected into Input.context. It is now rendered under [Conversation State / History]."}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:503:25)
      at RunnableCallable.invoke (node_modules/@langchain/langgraph/src/utils.ts:124:18)
      at RunnableSequence.invoke (node_modules/@langchain/core/dist/runnables/base.cjs:1321:33)
      at _runWithRetry (node_modules/@langchain/langgraph/src/pregel/retry.ts:105:16)
      at PregelRunner._executeTasksWithRetry (node_modules/@langchain/langgraph/src/pregel/runner.ts:351:21)
      at PregelRunner.tick (node_modules/@langchain/langgraph/src/pregel/runner.ts:135:31)
      at CompiledStateGraph._runLoop (node_modules/@langchain/langgraph/dist/pregel/index.cjs:1482:17)
      at createAndRunLoop (node_modules/@langchain/langgraph/src/pregel/index.ts:1945:8)
PASS src/services/llm-bot/processor.error.spec.ts
  ‚óè Console
    console.log
      {"ts":"2025-12-19T16:48:54.684Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:54.684Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:54.684Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:54.687Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:55.353Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-error","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:55.353Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":0,"names":[],"versions":[],"metrics":{"resolved":0,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"","constraintsCount":0,"correlationId":"c-error"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2025-12-19T16:48:55.353Z","service":"test-llm-bot","level":"warn","severity":"WARNING","msg":"llm_bot.deprecation.input_context_history","correlationId":"c-error","note":"Conversation history is no longer injected into Input.context. It is now rendered under [Conversation State / History]."}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:503:25)
      at RunnableCallable.invoke (node_modules/@langchain/langgraph/src/utils.ts:124:18)
      at RunnableSequence.invoke (node_modules/@langchain/core/dist/runnables/base.cjs:1321:33)
      at _runWithRetry (node_modules/@langchain/langgraph/src/pregel/retry.ts:105:16)
      at PregelRunner._executeTasksWithRetry (node_modules/@langchain/langgraph/src/pregel/runner.ts:351:21)
      at PregelRunner.tick (node_modules/@langchain/langgraph/src/pregel/runner.ts:135:31)
      at CompiledStateGraph._runLoop (node_modules/@langchain/langgraph/dist/pregel/index.cjs:1482:17)
      at createAndRunLoop (node_modules/@langchain/langgraph/src/pregel/index.ts:1945:8)
    console.error
      {"ts":"2025-12-19T16:48:55.355Z","service":"test-llm-bot","level":"error","severity":"ERROR","msg":"openai.error","correlationId":"c-error","model":"gpt-5-mini","durationMs":0,"message":"boom","name":"Error"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:639:28)
    console.error
      {"ts":"2025-12-19T16:48:55.355Z","service":"test-llm-bot","level":"error","severity":"ERROR","msg":"llm_bot.error","message":"boom","correlationId":"c-error","err":{"pregelTaskId":"55b81d77-7dac-5d0c-bd80-289ff4124d29"}}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at processEvent (src/services/llm-bot/processor.ts:693:12)
      at Object.<anonymous> (src/services/llm-bot/processor.error.spec.ts:25:20)
PASS src/services/llm-bot/processor.empty-response.spec.ts
  ‚óè Console
    console.log
      {"ts":"2025-12-19T16:48:55.565Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:55.565Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:55.566Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:55.568Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:56.122Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-empty","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:56.122Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":0,"names":[],"versions":[],"metrics":{"resolved":0,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"","constraintsCount":0,"correlationId":"c-empty"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2025-12-19T16:48:56.122Z","service":"test-llm-bot","level":"warn","severity":"WARNING","msg":"llm_bot.deprecation.input_context_history","correlationId":"c-empty","note":"Conversation history is no longer injected into Input.context. It is now rendered under [Conversation State / History]."}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:503:25)
      at RunnableCallable.invoke (node_modules/@langchain/langgraph/src/utils.ts:124:18)
      at RunnableSequence.invoke (node_modules/@langchain/core/dist/runnables/base.cjs:1321:33)
      at _runWithRetry (node_modules/@langchain/langgraph/src/pregel/retry.ts:105:16)
      at PregelRunner._executeTasksWithRetry (node_modules/@langchain/langgraph/src/pregel/runner.ts:351:21)
      at PregelRunner.tick (node_modules/@langchain/langgraph/src/pregel/runner.ts:135:31)
      at CompiledStateGraph._runLoop (node_modules/@langchain/langgraph/dist/pregel/index.cjs:1482:17)
      at createAndRunLoop (node_modules/@langchain/langgraph/src/pregel/index.ts:1945:8)
    console.log
      {"ts":"2025-12-19T16:48:56.125Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.empty_llm_response","correlationId":"c-empty"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:56.125Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:56.126Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:56.126Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:56.199Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-empty","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:56.199Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":0,"names":[],"versions":[],"metrics":{"resolved":0,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"","constraintsCount":0,"correlationId":"c-empty"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:56.201Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.empty_llm_response","correlationId":"c-empty"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.memory.spec.ts
  ‚óè Console
    console.log
      {"ts":"2025-12-19T16:48:56.409Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:56.410Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:56.410Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:56.412Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.046Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-mem","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.046Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":0,"names":[],"versions":[],"metrics":{"resolved":0,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"","constraintsCount":0,"correlationId":"c-mem"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2025-12-19T16:48:57.047Z","service":"test-llm-bot","level":"warn","severity":"WARNING","msg":"llm_bot.deprecation.input_context_history","correlationId":"c-mem","note":"Conversation history is no longer injected into Input.context. It is now rendered under [Conversation State / History]."}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:503:25)
      at RunnableCallable.invoke (node_modules/@langchain/langgraph/src/utils.ts:124:18)
      at RunnableSequence.invoke (node_modules/@langchain/core/dist/runnables/base.cjs:1321:33)
      at _runWithRetry (node_modules/@langchain/langgraph/src/pregel/retry.ts:105:16)
      at PregelRunner._executeTasksWithRetry (node_modules/@langchain/langgraph/src/pregel/runner.ts:351:21)
      at PregelRunner.tick (node_modules/@langchain/langgraph/src/pregel/runner.ts:135:31)
      at CompiledStateGraph._runLoop (node_modules/@langchain/langgraph/dist/pregel/index.cjs:1482:17)
      at createAndRunLoop (node_modules/@langchain/langgraph/src/pregel/index.ts:1945:8)
    console.log
      {"ts":"2025-12-19T16:48:57.050Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.050Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.051Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.116Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-mem","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.116Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":0,"names":[],"versions":[],"metrics":{"resolved":0,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"","constraintsCount":0,"correlationId":"c-mem"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.120Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.120Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.120Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.196Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-mem","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.196Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":0,"names":[],"versions":[],"metrics":{"resolved":0,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"","constraintsCount":0,"correlationId":"c-mem"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.instance-memory.spec.ts
  ‚óè Console
    console.log
      {"ts":"2025-12-19T16:48:57.400Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.401Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.401Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:57.403Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:58.139Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-inst","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:58.139Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":0,"names":[],"versions":[],"metrics":{"resolved":0,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"","constraintsCount":0,"correlationId":"c-inst"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2025-12-19T16:48:58.140Z","service":"test-llm-bot","level":"warn","severity":"WARNING","msg":"llm_bot.deprecation.input_context_history","correlationId":"c-inst","note":"Conversation history is no longer injected into Input.context. It is now rendered under [Conversation State / History]."}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:503:25)
      at RunnableCallable.invoke (node_modules/@langchain/langgraph/src/utils.ts:124:18)
      at RunnableSequence.invoke (node_modules/@langchain/core/dist/runnables/base.cjs:1321:33)
      at _runWithRetry (node_modules/@langchain/langgraph/src/pregel/retry.ts:105:16)
      at PregelRunner._executeTasksWithRetry (node_modules/@langchain/langgraph/src/pregel/runner.ts:351:21)
      at PregelRunner.tick (node_modules/@langchain/langgraph/src/pregel/runner.ts:135:31)
      at CompiledStateGraph._runLoop (node_modules/@langchain/langgraph/dist/pregel/index.cjs:1482:17)
      at createAndRunLoop (node_modules/@langchain/langgraph/src/pregel/index.ts:1945:8)
    console.log
      {"ts":"2025-12-19T16:48:58.310Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-inst","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:58.311Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":0,"names":[],"versions":[],"metrics":{"resolved":0,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"","constraintsCount":0,"correlationId":"c-inst"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:58.315Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:58.315Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:58.315Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:58.476Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-inst","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:58.476Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":0,"names":[],"versions":[],"metrics":{"resolved":0,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"","constraintsCount":0,"correlationId":"c-inst"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:58.640Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-inst","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:58.641Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":0,"names":[],"versions":[],"metrics":{"resolved":0,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"","constraintsCount":0,"correlationId":"c-inst"}
      at Logger.info (src/common/logging.ts:142:13)
PASS src/services/llm-bot/processor.openai.spec.ts
  ‚óè Console
    console.log
      {"ts":"2025-12-19T16:48:58.865Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:58.866Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:58.866Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:58.869Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:59.499Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-openai","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:59.499Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":0,"names":[],"versions":[],"metrics":{"resolved":0,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"","constraintsCount":0,"correlationId":"c-openai"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2025-12-19T16:48:59.500Z","service":"test-llm-bot","level":"warn","severity":"WARNING","msg":"llm_bot.deprecation.input_context_history","correlationId":"c-openai","note":"Conversation history is no longer injected into Input.context. It is now rendered under [Conversation State / History]."}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:503:25)
      at RunnableCallable.invoke (node_modules/@langchain/langgraph/src/utils.ts:124:18)
      at RunnableSequence.invoke (node_modules/@langchain/core/dist/runnables/base.cjs:1321:33)
      at _runWithRetry (node_modules/@langchain/langgraph/src/pregel/retry.ts:105:16)
      at PregelRunner._executeTasksWithRetry (node_modules/@langchain/langgraph/src/pregel/runner.ts:351:21)
      at PregelRunner.tick (node_modules/@langchain/langgraph/src/pregel/runner.ts:135:31)
      at CompiledStateGraph._runLoop (node_modules/@langchain/langgraph/dist/pregel/index.cjs:1482:17)
      at createAndRunLoop (node_modules/@langchain/langgraph/src/pregel/index.ts:1945:8)
PASS src/services/llm-bot/processor.personality.spec.ts
  ‚óè Console
    console.log
      {"ts":"2025-12-19T16:48:59.704Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:59.704Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:59.704Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:48:59.707Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:00.319Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-pers","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:00.320Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":1,"names":[],"versions":[],"metrics":{"resolved":1,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":0,"clamped":0},"identityPreview":"PERS","constraintsCount":0,"correlationId":"c-pers"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2025-12-19T16:49:00.320Z","service":"test-llm-bot","level":"warn","severity":"WARNING","msg":"llm_bot.deprecation.input_context_history","correlationId":"c-pers","note":"Conversation history is no longer injected into Input.context. It is now rendered under [Conversation State / History]."}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:503:25)
      at RunnableCallable.invoke (node_modules/@langchain/langgraph/src/utils.ts:124:18)
      at RunnableSequence.invoke (node_modules/@langchain/core/dist/runnables/base.cjs:1321:33)
      at _runWithRetry (node_modules/@langchain/langgraph/src/pregel/retry.ts:105:16)
      at PregelRunner._executeTasksWithRetry (node_modules/@langchain/langgraph/src/pregel/runner.ts:351:21)
      at PregelRunner.tick (node_modules/@langchain/langgraph/src/pregel/runner.ts:135:31)
      at CompiledStateGraph._runLoop (node_modules/@langchain/langgraph/dist/pregel/index.cjs:1482:17)
      at createAndRunLoop (node_modules/@langchain/langgraph/src/pregel/index.ts:1945:8)
PASS src/services/llm-bot/processor.personality-disabled.spec.ts
  ‚óè Console
    console.log
      {"ts":"2025-12-19T16:49:00.519Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:00.519Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:00.519Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:00.522Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:01.218Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-pers-disabled","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2025-12-19T16:49:01.218Z","service":"test-llm-bot","level":"warn","severity":"WARNING","msg":"llm_bot.deprecation.input_context_history","correlationId":"c-pers-disabled","note":"Conversation history is no longer injected into Input.context. It is now rendered under [Conversation State / History]."}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:503:25)
      at RunnableCallable.invoke (node_modules/@langchain/langgraph/src/utils.ts:124:18)
      at RunnableSequence.invoke (node_modules/@langchain/core/dist/runnables/base.cjs:1321:33)
      at _runWithRetry (node_modules/@langchain/langgraph/src/pregel/retry.ts:105:16)
      at PregelRunner._executeTasksWithRetry (node_modules/@langchain/langgraph/src/pregel/runner.ts:351:21)
      at PregelRunner.tick (node_modules/@langchain/langgraph/src/pregel/runner.ts:135:31)
      at CompiledStateGraph._runLoop (node_modules/@langchain/langgraph/dist/pregel/index.cjs:1482:17)
      at createAndRunLoop (node_modules/@langchain/langgraph/src/pregel/index.ts:1945:8)
PASS src/services/llm-bot/__tests__/processor.unwrap-quotes.spec.ts
  ‚óè Console
    console.log
      {"ts":"2025-12-19T16:49:01.419Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:01.420Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:01.420Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2025-12-19T16:49:01.422Z","service":"test-llm-bot","level":"warn","severity":"WARNING","msg":"llm_bot.deprecation.input_context_history","correlationId":"c-unwrap","note":"Conversation history is no longer injected into Input.context. It is now rendered under [Conversation State / History]."}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:503:25)
      at RunnableCallable.invoke (node_modules/@langchain/langgraph/src/utils.ts:124:18)
      at RunnableSequence.invoke (node_modules/@langchain/core/dist/runnables/base.cjs:1321:33)
      at _runWithRetry (node_modules/@langchain/langgraph/src/pregel/retry.ts:105:16)
      at PregelRunner._executeTasksWithRetry (node_modules/@langchain/langgraph/src/pregel/runner.ts:351:21)
      at PregelRunner.tick (node_modules/@langchain/langgraph/src/pregel/runner.ts:135:31)
      at CompiledStateGraph._runLoop (node_modules/@langchain/langgraph/dist/pregel/index.cjs:1482:17)
      at createAndRunLoop (node_modules/@langchain/langgraph/src/pregel/index.ts:1945:8)
PASS src/services/llm-bot/__tests__/processor.personality-name.spec.ts
  ‚óè Console
    console.log
      {"ts":"2025-12-19T16:49:01.607Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:01.608Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:01.608Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:01.610Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-pers-name","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:01.611Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":1,"names":["p1"],"versions":[7],"metrics":{"resolved":1,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":1,"clamped":0},"identityPreview":"DBTEXT","constraintsCount":0,"correlationId":"c-pers-name"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2025-12-19T16:49:01.611Z","service":"test-llm-bot","level":"warn","severity":"WARNING","msg":"llm_bot.deprecation.input_context_history","correlationId":"c-pers-name","note":"Conversation history is no longer injected into Input.context. It is now rendered under [Conversation State / History]."}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:503:25)
      at RunnableCallable.invoke (node_modules/@langchain/langgraph/src/utils.ts:124:18)
      at RunnableSequence.invoke (node_modules/@langchain/core/dist/runnables/base.cjs:1321:33)
      at _runWithRetry (node_modules/@langchain/langgraph/src/pregel/retry.ts:105:16)
      at PregelRunner._executeTasksWithRetry (node_modules/@langchain/langgraph/src/pregel/runner.ts:351:21)
      at PregelRunner.tick (node_modules/@langchain/langgraph/src/pregel/runner.ts:135:31)
      at CompiledStateGraph._runLoop (node_modules/@langchain/langgraph/dist/pregel/index.cjs:1482:17)
      at createAndRunLoop (node_modules/@langchain/langgraph/src/pregel/index.ts:1945:8)
PASS src/services/llm-bot/__tests__/processor.personality-mixed.spec.ts
  ‚óè Console
    console.log
      {"ts":"2025-12-19T16:49:01.788Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:01.789Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:01.789Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:01.791Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-pers-mixed","mode":"append","hasDescription":false,"preview":""}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:01.792Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.personality.mapped","count":2,"names":["p2"],"versions":[9],"metrics":{"resolved":2,"failed":0,"dropped":0,"cacheHit":0,"cacheMiss":1,"clamped":0},"identityPreview":"INLINE\n\nDBTEXT2","constraintsCount":0,"correlationId":"c-pers-mixed"}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2025-12-19T16:49:01.792Z","service":"test-llm-bot","level":"warn","severity":"WARNING","msg":"llm_bot.deprecation.input_context_history","correlationId":"c-pers-mixed","note":"Conversation history is no longer injected into Input.context. It is now rendered under [Conversation State / History]."}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:503:25)
      at RunnableCallable.invoke (node_modules/@langchain/langgraph/src/utils.ts:124:18)
      at RunnableSequence.invoke (node_modules/@langchain/core/dist/runnables/base.cjs:1321:33)
      at _runWithRetry (node_modules/@langchain/langgraph/src/pregel/retry.ts:105:16)
      at PregelRunner._executeTasksWithRetry (node_modules/@langchain/langgraph/src/pregel/runner.ts:351:21)
      at PregelRunner.tick (node_modules/@langchain/langgraph/src/pregel/runner.ts:135:31)
      at CompiledStateGraph._runLoop (node_modules/@langchain/langgraph/dist/pregel/index.cjs:1482:17)
      at createAndRunLoop (node_modules/@langchain/langgraph/src/pregel/index.ts:1945:8)
PASS src/services/llm-bot/reducer.spec.ts
PASS src/services/llm-bot/__tests__/user-context.append.spec.ts
  ‚óè Console
    console.log
      {"ts":"2025-12-19T16:49:02.150Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:02.150Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:02.150Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-19T16:49:02.153Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.user_ctx.compose.end","correlationId":"c-userctx-append","mode":"append","hasDescription":true,"preview":"Username: Alice\nRoles: VIP\nThey are a VIP.\nDescription: Loves JRPGs."}
      at Logger.info (src/common/logging.ts:142:13)
    console.warn
      {"ts":"2025-12-19T16:49:02.154Z","service":"test-llm-bot","level":"warn","severity":"WARNING","msg":"llm_bot.deprecation.input_context_history","correlationId":"c-userctx-append","note":"Conversation history is no longer injected into Input.context. It is now rendered under [Conversation State / History]."}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:503:25)
      at RunnableCallable.invoke (node_modules/@langchain/langgraph/src/utils.ts:124:18)
      at RunnableSequence.invoke (node_modules/@langchain/core/dist/runnables/base.cjs:1321:33)
      at _runWithRetry (node_modules/@langchain/langgraph/src/pregel/retry.ts:105:16)
      at PregelRunner._executeTasksWithRetry (node_modules/@langchain/langgraph/src/pregel/runner.ts:351:21)
      at PregelRunner.tick (node_modules/@langchain/langgraph/src/pregel/runner.ts:135:31)
      at CompiledStateGraph._runLoop (node_modules/@langchain/langgraph/dist/pregel/index.cjs:1482:17)
      at createAndRunLoop (node_modules/@langchain/langgraph/src/pregel/index.ts:1945:8)
PASS src/services/llm-bot/__tests__/personality-resolver.spec.ts
PASS src/services/llm-bot/__tests__/personality-resolver-sorting.spec.ts
PASS src/services/llm-bot/instance-memory.spec.ts
PASS src/services/llm-bot/__tests__/personality-metrics.spec.ts
PASS src/services/llm-bot/__tests__/prompt-composer.spec.ts
Test Suites: 18 passed, 18 total
Tests:       42 passed, 42 total
Snapshots:   0 total
Time:        12.02 s, estimated 26 s
Ran all test suites matching /src\/services\/llm-bot/i.
üß™ Quoting logic verification...
Executing: gcloud run deploy llm-bot --image us-central1-docker.pkg.dev/PROJECT_ID/REPO/llm-bot:latest --region us-central1 --platform managed --port 3000 --min-instances 1 --max-instances 1 --cpu 1 --memory 512Mi --execution-environment gen2 --no-cpu-throttling --ingress internal-and-cloud-load-balancing --vpc-connector brat-conn-us-central1-dev --allow-unauthenticated --set-secrets OPENAI_API_KEY=OPENAI_API_KEY:1 --set-env-vars ^~^BUS_PREFIX=dev.~ENV_PREFIX=dev.~LLM_BOT_ENABLED=true~LLM_BOT_SYSTEM_PROMPT=You are BitBrat, a conversational, entertaining assistant. You may push boundaries, but NEVER in cruelty, and can be extremely kind when the moment is right. Always, always, laugh at the world, but also always show others understanding. Use the improv concept of 'Yes, and' when responding to users. Be creative, but never at the expense of being kind and understanding, though throwing a few little jokes and puns at people when appropriate never hurt anyone. We are all friends here, so jest away!
MOCK GCLOUD CALLED WITH ARGS:
  ARG: [run]
  ARG: [deploy]
  ARG: [llm-bot]
  ARG: [--image]
  ARG: [us-central1-docker.pkg.dev/PROJECT_ID/REPO/llm-bot:latest]
  ARG: [--region]
  ARG: [us-central1]
  ARG: [--platform]
  ARG: [managed]
  ARG: [--port]
  ARG: [3000]
  ARG: [--min-instances]
  ARG: [1]
  ARG: [--max-instances]
  ARG: [1]
  ARG: [--cpu]
  ARG: [1]
  ARG: [--memory]
  ARG: [512Mi]
  ARG: [--execution-environment]
  ARG: [gen2]
  ARG: [--no-cpu-throttling]
  ARG: [--ingress]
  ARG: [internal-and-cloud-load-balancing]
  ARG: [--vpc-connector]
  ARG: [brat-conn-us-central1-dev]
  ARG: [--allow-unauthenticated]
  ARG: [--set-secrets]
  ARG: [OPENAI_API_KEY=OPENAI_API_KEY:1]
  ARG: [--set-env-vars]
  ARG: [^~^BUS_PREFIX=dev.~ENV_PREFIX=dev.~LLM_BOT_ENABLED=true~LLM_BOT_SYSTEM_PROMPT=You are BitBrat, a conversational, entertaining assistant. You may push boundaries, but NEVER in cruelty, and can be extremely kind when the moment is right. Always, always, laugh at the world, but also always show others understanding. Use the improv concept of 'Yes, and' when responding to users. Be creative, but never at the expense of being kind and understanding, though throwing a few little jokes and puns at people when appropriate never hurt anyone. We are all friends here, so jest away!]
üß™ Prompt Assembly smoke (canonical text) ...
üß™ Prompt Assembly smoke (OpenAI adapter) ...
‚úÖ Validation (install/build/tests) completed. Infra and deployment steps skipped due to missing PROJECT_ID.
