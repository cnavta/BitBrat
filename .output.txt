[validate_deliverable] Notice: PROJECT_ID not provided. Will run install/build/tests only and skip infra + deployment steps.
ðŸ”§ Installing dependencies...
up to date, audited 806 packages in 1s
143 packages are looking for funding
  run `npm fund` for details
4 vulnerabilities (2 moderate, 2 high)
To address all issues, run:
  npm audit fix
Run `npm audit` for details.
ðŸ§± Compiling...
> bitbrat-platform@1.0.0 build
> tsc -p tsconfig.json
ðŸ§ª Running tests (scope=llm-bot)...
> bitbrat-platform@1.0.0 test
> jest src/services/llm-bot
PASS src/services/llm-bot/instance-memory.spec.ts
PASS src/services/llm-bot/reducer.spec.ts
PASS src/services/llm-bot/processor.empty-response.spec.ts
  â— Console
    console.log
      {"ts":"2025-12-10T12:48:22.321Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.325Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.326Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.326Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.326Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.328Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.345Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.empty_llm_response","correlationId":"c-empty"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.347Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.348Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.348Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.348Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.348Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.357Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.empty_llm_response","correlationId":"c-empty"}
      at Logger.info (src/common/logging.ts:149:17)
PASS src/services/llm-bot/processor.memory.spec.ts
  â— Console
    console.log
      {"ts":"2025-12-10T12:48:22.569Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.569Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.569Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.569Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.570Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.570Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.575Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.575Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.575Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.576Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.576Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.580Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.580Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.580Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.580Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.580Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:149:17)
PASS src/services/llm-bot/processor.test.ts
  â— Console
    console.log
      {"ts":"2025-12-10T12:48:22.792Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.793Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.793Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.793Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.793Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.793Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.796Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"llm_bot.no_prompt_annotations","correlationId":"c-1"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.797Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.797Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.797Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.797Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.797Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:149:17)
PASS src/services/llm-bot/processor.openai.spec.ts
  â— Console
    console.log
      {"ts":"2025-12-10T12:48:22.996Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.996Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.997Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.997Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.997Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:22.997Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:149:17)
    console.debug
      openai.request.raw {"model":"gpt-5-mini","input":"(user) hello\n\n(user) Say hi","max_output_tokens":1024}
      at callOpenAI (src/services/llm-bot/processor.ts:98:11)
    console.debug
      openai.response.raw {"output_text":"Hello world"}
      at callOpenAI (src/services/llm-bot/processor.ts:104:11)
PASS src/services/llm-bot/processor.error.spec.ts
  â— Console
    console.log
      {"ts":"2025-12-10T12:48:23.201Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:23.201Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:23.201Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:23.201Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:23.201Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:149:17)
    console.log
      {"ts":"2025-12-10T12:48:23.202Z","service":"test-llm-bot","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:149:17)
    console.error
      {"ts":"2025-12-10T12:48:23.205Z","service":"test-llm-bot","level":"error","severity":"ERROR","msg":"openai.error","correlationId":"c-error","model":"gpt-5-mini","durationMs":0,"message":"boom","name":"Error"}
      137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
      138 |   }
    > 139 |
          | ^
      140 |   info(msg: string, context?: Record<string, unknown>) {
      141 |     if (!this.shouldLog('info')) return;
      142 |     console.log(JSON.stringify(this.base({ level: 'info', severity: this.severityOf('info'), msg, ...(this.sanitize(context) || {}) })));
      at Logger.error (src/common/logging.ts:139:17)
      at RunnableCallable.func (src/services/llm-bot/processor.ts:282:28)
    console.error
      {"ts":"2025-12-10T12:48:23.206Z","service":"test-llm-bot","level":"error","severity":"ERROR","msg":"llm_bot.error","message":"boom","correlationId":"c-error","err":{"pregelTaskId":"2dddcdc5-5df8-5c71-8498-29c20fc84d37"}}
      137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
      138 |   }
    > 139 |
          | ^
      140 |   info(msg: string, context?: Record<string, unknown>) {
      141 |     if (!this.shouldLog('info')) return;
      142 |     console.log(JSON.stringify(this.base({ level: 'info', severity: this.severityOf('info'), msg, ...(this.sanitize(context) || {}) })));
      at Logger.error (src/common/logging.ts:139:17)
      at processEvent (src/services/llm-bot/processor.ts:336:12)
      at Object.<anonymous> (src/services/llm-bot/processor.error.spec.ts:25:20)
Test Suites: 7 passed, 7 total
Tests:       17 passed, 17 total
Snapshots:   0 total
Time:        3.313 s
Ran all test suites matching /src\/services\/llm-bot/i.
âœ… Validation (install/build/tests) completed. Infra and deployment steps skipped due to missing PROJECT_ID.
