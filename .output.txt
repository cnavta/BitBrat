
> bitbrat-platform@1.0.0 test
> jest src/services/ingress/twilio src/apps/ingress-egress-service.finalize.spec.ts src/apps/__tests__/ingress-egress-routing.test.ts
(node:80629) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
 PASS  src/services/ingress/twilio/__tests__/twilio-envelope-builder.spec.ts
(node:80627) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
 PASS  src/services/ingress/twilio/__tests__/twilio-ingress-client.spec.ts
  ● Console
    console.log
      {"ts":"2025-12-28T16:39:04.945Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"bot-identity"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:04.953Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Twilio Ingress Client connected and listening"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:04.955Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"bot-identity"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:04.955Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Twilio Ingress Client connected and listening"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:04.956Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"bot-identity"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:04.956Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Twilio Ingress Client connected and listening"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:04.956Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"bot-identity"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:04.957Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Twilio Ingress Client connected and listening"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:04.957Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Starting Twilio Ingress Client","identity":"bot-identity"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:04.957Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Twilio Ingress Client connected and listening"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:04.957Z","service":"bitbrat","level":"info","severity":"INFO","msg":"Twilio Ingress Client stopped"}
      at Logger.info (src/common/logging.ts:142:13)
 PASS  src/services/ingress/twilio/__tests__/token-provider.spec.ts
(node:80628) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:80626) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
 PASS  src/apps/ingress-egress-service.finalize.spec.ts
  ● Console
    console.log
      {"ts":"2025-12-28T16:39:05.842Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.854Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.855Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.855Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.855Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.857Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.858Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"auto","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.error
      {"ts":"2025-12-28T16:39:05.901Z","service":"ingress-egress","level":"error","severity":"ERROR","msg":"connector.start_error","name":"twitch","error":"twitch_auth_missing"}
      130 |   error(msg: string, context?: Record<string, unknown>) {
      131 |     if (!this.shouldLog('error')) return;
    > 132 |     console.error(JSON.stringify(this.base({ level: 'error', severity: this.severityOf('error'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      133 |   }
      134 |
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      at Logger.error (src/common/logging.ts:132:13)
      at ConnectorManager.start (src/services/ingress/core/connector-manager.ts:39:34)
      at IngressEgressServer.setupApp (src/apps/ingress-egress-service.ts:147:7)
    console.log
      {"ts":"2025-12-28T16:39:05.902Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.902Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.902Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-7xaflf65","queue":"ingress-egress.proc-7xaflf65"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.903Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.ok","subject":"internal.egress.v1.proc-7xaflf65"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.903Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.903Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/_debug/discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.903Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.903Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"twitch-eventsub","from":"NONE","to":"ERROR"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.903Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.status_change","name":"discord","from":"NONE","to":"CONNECTED"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.906Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"fx-1","candidateId":"c1","priority":1,"createdAt":"2025-12-28T16:39:05.905Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.907Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"fx-1","source":"","isDiscord":false,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.908Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"fx-1","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
(node:80625) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
 PASS  src/apps/__tests__/ingress-egress-routing.test.ts (5.957 s)
  ● Console
    console.log
      {"ts":"2025-12-28T16:39:05.843Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.855Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.856Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.856Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.856Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"Initializing Firestore","databaseId":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.858Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:05.859Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"auto","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.051Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"pubsub.client.init","apiEndpoint":"default","projectId":"auto"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.054Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"pubsub.publisher.init","topic":"internal.ingress.v1","batching":{"maxMessages":100,"maxMilliseconds":20},"ensureMode":"on-publish-fail","publishTimeoutMs":0}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.054Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.055Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.055Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.055Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-5r56yumm","queue":"ingress-egress.proc-5r56yumm"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.055Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"pubsub.client.init","apiEndpoint":"default","projectId":"auto"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.055Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-5r56yumm","queue":"ingress-egress.proc-5r56yumm"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.055Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"message_consumer.subscribe.start","driver":"pubsub","topic":"internal.egress.v1.proc-5r56yumm","subscription":"internal.egress.v1.proc-5r56yumm.ingress-egress.proc-5r56yumm","ackDeadline":60}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.557Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-1","candidateId":"cand-1","priority":1,"createdAt":"2025-12-28T16:39:06.556Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.558Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-1","source":"ingress.discord","isDiscord":true,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.562Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-1","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.564Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.564Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.564Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.565Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.565Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.565Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"auto","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.565Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.565Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.565Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.565Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-9g825ux7","queue":"ingress-egress.proc-9g825ux7"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.565Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"pubsub.client.init","apiEndpoint":"default","projectId":"auto"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.566Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-9g825ux7","queue":"ingress-egress.proc-9g825ux7"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:06.566Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"message_consumer.subscribe.start","driver":"pubsub","topic":"internal.egress.v1.proc-9g825ux7","subscription":"internal.egress.v1.proc-9g825ux7.ingress-egress.proc-9g825ux7","ackDeadline":60}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.066Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-3","candidateId":"cand-3","priority":1,"createdAt":"2025-12-28T16:39:07.066Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.067Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-3","source":"command-processor","isDiscord":true,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.067Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-3","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.068Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.068Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.068Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.068Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.068Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.069Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"auto","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.069Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.069Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.069Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.069Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-7vifuvst","queue":"ingress-egress.proc-7vifuvst"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.069Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"pubsub.client.init","apiEndpoint":"default","projectId":"auto"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.069Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-7vifuvst","queue":"ingress-egress.proc-7vifuvst"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.069Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"message_consumer.subscribe.start","driver":"pubsub","topic":"internal.egress.v1.proc-7vifuvst","subscription":"internal.egress.v1.proc-7vifuvst.ingress-egress.proc-7vifuvst","ackDeadline":60}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.569Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-v1","source":"ingress.discord","isDiscord":true,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.570Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-v1","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.570Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher","firestore"]}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.570Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.571Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.571Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"firestore.manager.setup.reuse"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.571Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"fi***tore"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.571Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.config","messageBusDriver":"auto","pubsub":{"batchMaxMs":"(default: 20)","batchMaxMessages":"(default: 100)","publishTimeoutMs":"(auto: 2000 in Cloud Run, 0 locally)","ensureMode":"(default: on-publish-fail)"}}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.571Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.571Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"twitch-eventsub"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.571Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"connector.started","name":"discord"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.571Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress_subscribe.start","subject":"internal.egress.v1.proc-38oud94z","queue":"ingress-egress.proc-38oud94z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.571Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"pubsub.client.init","apiEndpoint":"default","projectId":"auto"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.571Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"base_server.message.subscribe.start","subject":"internal.egress.v1.proc-38oud94z","queue":"ingress-egress.proc-38oud94z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:07.572Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"message_consumer.subscribe.start","driver":"pubsub","topic":"internal.egress.v1.proc-38oud94z","subscription":"internal.egress.v1.proc-38oud94z.ingress-egress.proc-38oud94z","ackDeadline":60}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:08.072Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.candidate_selected","correlationId":"corr-2","candidateId":"cand-2","priority":1,"createdAt":"2025-12-28T16:39:08.072Z"}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:08.072Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.egress.sent","correlationId":"corr-2","source":"ingress.twitch","isDiscord":false,"isTwilio":false}
      at Logger.info (src/common/logging.ts:142:13)
    console.log
      {"ts":"2025-12-28T16:39:08.072Z","service":"ingress-egress","level":"info","severity":"INFO","msg":"ingress-egress.finalize.published","correlationId":"corr-2","status":"SENT"}
      at Logger.info (src/common/logging.ts:142:13)
A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Test Suites: 5 passed, 5 total
Tests:       14 passed, 14 total
Snapshots:   0 total
Time:        6.921 s
Ran all test suites matching /src\/services\/ingress\/twilio|src\/apps\/ingress-egress-service.finalize.spec.ts|src\/apps\/__tests__\/ingress-egress-routing.test.ts/i.
