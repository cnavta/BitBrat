ðŸ”§ Installing dependencies...
up to date, audited 903 packages in 2s
167 packages are looking for funding
  run `npm fund` for details
6 vulnerabilities (2 moderate, 4 high)
To address all issues, run:
  npm audit fix
Run `npm audit` for details.
ðŸ§± Building project...
> bitbrat-platform@1.0.0 build
> tsc -p tsconfig.json
ðŸ§ª Running tests...
> bitbrat-platform@1.0.0 test
> jest tests/common/mcp-server.spec.ts
  console.log
    {"ts":"2026-01-09T14:19:28.181Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.200Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.202Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.210Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.210Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.229Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.231Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.236Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.236Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.237Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.238Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.238Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.239Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.241Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.242Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.244Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.244Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.245Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.245Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.246Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.246Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.247Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.247Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.249Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.249Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.warn
    {"ts":"2026-01-09T14:19:28.251Z","service":"test-mcp-server","level":"warn","severity":"WARNING","msg":"mcp_server.auth_failed","path":"/sse","ip":"::ffff:127.0.0.1"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at authMiddleware (src/common/mcp-server.ts:206:28)
      at src/common/mcp-server.ts:218:7
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at app.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)
  console.log
    {"ts":"2026-01-09T14:19:28.253Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.254Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.254Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.255Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.255Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.256Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.257Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.258Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.warn
    {"ts":"2026-01-09T14:19:28.259Z","service":"test-mcp-server","level":"warn","severity":"WARNING","msg":"mcp_server.auth_failed","path":"/sse","ip":"::ffff:127.0.0.1"}
      135 |   warn(msg: string, context?: Record<string, unknown>) {
      136 |     if (!this.shouldLog('warn')) return;
    > 137 |     console.warn(JSON.stringify(this.base({ level: 'warn', severity: this.severityOf('warn'), msg, ...(this.sanitize(context) || {}) })));
          |             ^
      138 |   }
      139 |
      140 |   info(msg: string, context?: Record<string, unknown>) {
      at Logger.warn (src/common/logging.ts:137:13)
      at authMiddleware (src/common/mcp-server.ts:206:28)
      at src/common/mcp-server.ts:218:7
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at app.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)
  console.log
    {"ts":"2026-01-09T14:19:28.261Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.262Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.262Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.263Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.263Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.264Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.265Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.265Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.267Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.267Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.268Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.268Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.269Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.270Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.270Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.271Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.272Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.273Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.274Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.sse_connection_attempt"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.275Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.connected","sessionId":"test-session"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.275Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":1}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.275Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.276Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.276Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.277Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.278Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.279Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.279Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.280Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.281Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.281Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.282Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.282Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.283Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.283Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.284Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.285Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.285Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.286Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.287Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.287Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.288Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.tool_registered","name":"test_tool"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.289Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.289Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.290Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.290Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.291Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.291Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.293Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.293Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.294Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.resource_registered","name":"test_resource","uri":"file://test"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.294Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.294Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.295Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.295Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resources.init","keys":["publisher"]}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.296Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"publisher.manager.setup"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.296Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.setup.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.298Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"GET","path":"/sse"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.298Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.http.register","method":"POST","path":"/message"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.298Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.prompt_registered","name":"test_prompt"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.299Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"mcp_server.closing","reason":"manual","activeTransports":0}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.299Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.shutdown.start","reason":"manual"}
      at Logger.info (src/common/logging.ts:142:13)
  console.log
    {"ts":"2026-01-09T14:19:28.300Z","service":"test-mcp-server","level":"info","severity":"INFO","msg":"base_server.resource.shutdown.ok","key":"pu***sher"}
      at Logger.info (src/common/logging.ts:142:13)
(node:37741) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGTERM listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
(node:37741) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGINT listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:37741) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 beforeExit listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:37741) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 exit listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
 PASS  tests/common/mcp-server.spec.ts
  McpServer
    Endpoints Registration
      âœ“ should register /sse and /message endpoints (59 ms)
    Security
      âœ“ should allow access if MCP_AUTH_TOKEN is not set (9 ms)
      âœ“ should return 401 if MCP_AUTH_TOKEN is set and token is missing (8 ms)
      âœ“ should return 401 if MCP_AUTH_TOKEN is set and token is incorrect (7 ms)
      âœ“ should allow access if correct token is provided in header (7 ms)
      âœ“ should allow access if correct token is provided in query (7 ms)
    Registration Helpers
      âœ“ should use description and version from architecture.yaml (8 ms)
      âœ“ should register a tool correctly (6 ms)
      âœ“ should register a resource correctly (5 ms)
      âœ“ should register a prompt correctly (5 ms)
Test Suites: 1 passed, 1 total
Tests:       10 passed, 10 total
Snapshots:   0 total
Time:        2.355 s
Ran all test suites matching /tests\/common\/mcp-server.spec.ts/i.
ðŸƒ Verifying brat command (dry-run)...
> bitbrat-platform@1.0.0 brat
> node dist/tools/brat/src/cli/index.js cloud-run shutdown --dry-run --project-id bitbrat-local
{"component":"brat","action":"config.interpolate","vars_used":["DOMAIN_SUFFIX","ENV","ENV_PREFIX"],"unresolved":[],"notice":"Set BITBRAT_INTERPOLATION=0 to disable interpolation temporarily"}
{"level":30,"time":1767968368662,"runId":"8a936fe","component":"brat","action":"cloud-run.shutdown.start","env":"dev","projectId":"bitbrat-local","msg":"Shutting down 9 Cloud Run services"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"oauth-flow","region":"us-central1","status":"scaling-zero","msg":"Scaling oauth-flow to zero instances"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"oauth-flow","region":"us-central1","status":"dry-run","command":"gcloud run services update oauth-flow --min-instances=0 --region us-central1 --project bitbrat-local --quiet","msg":"DRY-RUN: Would scale oauth-flow to zero"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"ingress-egress","region":"us-central1","status":"scaling-zero","msg":"Scaling ingress-egress to zero instances"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"ingress-egress","region":"us-central1","status":"dry-run","command":"gcloud run services update ingress-egress --min-instances=0 --region us-central1 --project bitbrat-local --quiet","msg":"DRY-RUN: Would scale ingress-egress to zero"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"auth","region":"us-central1","status":"scaling-zero","msg":"Scaling auth to zero instances"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"auth","region":"us-central1","status":"dry-run","command":"gcloud run services update auth --min-instances=0 --region us-central1 --project bitbrat-local --quiet","msg":"DRY-RUN: Would scale auth to zero"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"event-router","region":"us-central1","status":"scaling-zero","msg":"Scaling event-router to zero instances"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"event-router","region":"us-central1","status":"dry-run","command":"gcloud run services update event-router --min-instances=0 --region us-central1 --project bitbrat-local --quiet","msg":"DRY-RUN: Would scale event-router to zero"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"llm-bot","region":"us-central1","status":"scaling-zero","msg":"Scaling llm-bot to zero instances"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"llm-bot","region":"us-central1","status":"dry-run","command":"gcloud run services update llm-bot --min-instances=0 --region us-central1 --project bitbrat-local --quiet","msg":"DRY-RUN: Would scale llm-bot to zero"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"persistence","region":"us-central1","status":"scaling-zero","msg":"Scaling persistence to zero instances"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"persistence","region":"us-central1","status":"dry-run","command":"gcloud run services update persistence --min-instances=0 --region us-central1 --project bitbrat-local --quiet","msg":"DRY-RUN: Would scale persistence to zero"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"command-processor","region":"us-central1","status":"scaling-zero","msg":"Scaling command-processor to zero instances"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"command-processor","region":"us-central1","status":"dry-run","command":"gcloud run services update command-processor --min-instances=0 --region us-central1 --project bitbrat-local --quiet","msg":"DRY-RUN: Would scale command-processor to zero"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"obs-mcp","region":"us-central1","status":"scaling-zero","msg":"Scaling obs-mcp to zero instances"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"obs-mcp","region":"us-central1","status":"dry-run","command":"gcloud run services update obs-mcp --min-instances=0 --region us-central1 --project bitbrat-local --quiet","msg":"DRY-RUN: Would scale obs-mcp to zero"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"scheduler","region":"us-central1","status":"scaling-zero","msg":"Scaling scheduler to zero instances"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","service":"scheduler","region":"us-central1","status":"dry-run","command":"gcloud run services update scheduler --min-instances=0 --region us-central1 --project bitbrat-local --quiet","msg":"DRY-RUN: Would scale scheduler to zero"}
{"level":30,"time":1767968368663,"runId":"8a936fe","component":"brat","action":"cloud-run.shutdown.complete","msg":"Cloud Run shutdown completed"}
âœ… Validation complete.
